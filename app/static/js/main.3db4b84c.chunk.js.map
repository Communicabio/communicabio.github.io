{"version":3,"sources":["img/communicabio.svg","panels/Params.js","panels/Home.js","panels/Rating.js","App.js","index.js"],"names":["module","exports","__webpack_require__","p","SERVER_URL","Home","React","Component","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","console","log","state","popout","history","disabled","token","create_alert","bind","assertThisInitialized","prepare_alert","get_reply_to","handle_send_message","rollback_dialog","remove_alert","message2Cell","onHandleFormChange","onHandleFormSubmit","get_new_dialog","get_score","get_chat_history","isTooltipClosed","closeTooltip","create_feedback_panel","renderFeedbackPanel","then","length","setState","fetch","URLSearchParams","json","formatted_list","last_dialog","user","i","push","text","actor","method","body","JSON","stringify","response","chat_history","localStorage","setItem","headers","Content-Type","msg","message","result","_this2","flag","_this3","_this4","react_default","a","createElement","Card_default","mode","size","forEach","item","element","es6","isShown","tooltip","onClose","offsetX","Cell_default","_this5","Panel_default","id","Div_default","map","renderMessage","style","height","vertical","Button_default","onClick","scores","ind","hint_count","mistakes","metric","mistake","word","_this6","alert_element","Alert_default","actionsLayout","actions","title","autoclose","action","_this7","dict","score","toFixed","multiline","before","Avatar_default","src","require","e","user_message","target","value","preventDefault","array","tooltips","j","repl","PanelHeader_default","marginTop","_this8","0","1","display","stretched","marginRight","arrow_uturn_left_outline_default","cancel_default","Separator_default","position","Textarea_default","float","marginBottom","onChange","defaultValue","send_default","chatRender","loadigRender","Rating","N","M","place","our_place","table","changePlace","getUserInfo","renderRating","getRatingTable","goHome","start","end","n","m","rating","CardGrid_default","entry","delta","info","Math","max","up_default","home_outline_default","down_default","App","parseQueryString","string","slice","split","queryParam","kvp","key","reduce","query","go","activePanel","currentTarget","dataset","to","fetchedUser","activeStory","renderHome","onStoryChange","obtainToken","story","urlParams","window","location","search","req_params","data","src_panels_Home","panels_Rating","tabbar","selected","data-story","chats_outline_default","list_outline_default","connect","send","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.3db4b84c.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/communicabio.e8edc935.svg\";","var SERVER_URL = \"https://communicabio-server-b7e3qu3u4a-uc.a.run.app/\";\nexport default SERVER_URL;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\nimport List from '@vkontakte/vkui/dist/components/List/List'\nimport FormLayout from '@vkontakte/vkui/dist/components/FormLayout/FormLayout'\nimport Textarea from '@vkontakte/vkui/dist/components/Textarea/Textarea'\nimport Card from '@vkontakte/vkui/dist/components/Card/Card'\nimport CardGrid from '@vkontakte/vkui/dist/components/CardGrid/CardGrid'\nimport Input from '@vkontakte/vkui/dist/components/Input/Input'\nimport Separator from '@vkontakte/vkui/dist/components/Separator/Separator'\nimport Alert from '@vkontakte/vkui/dist/components/Alert/Alert'\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\nimport Icon24Send from '@vkontakte/icons/dist/24/send';\nimport Icon24ArrowUturnLeftOutline from '@vkontakte/icons/dist/24/arrow_uturn_left_outline';\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\nimport './Home.css'\nimport SERVER_URL from './Params'\nimport ReactDOM from 'react-dom'\nimport {FixedLayout} from '@vkontakte/vkui'\nimport { Tooltip} from '@vkontakte/vkui';\nimport { PanelSpinner, ScreenSpinner, Spinner } from '@vkontakte/vkui';\n\nvar node_before_alert = null;\n\nclass Example extends React.Component {\n\tconstructor(props) {\n\t\tsuper();\n\t}\n\n\trender() {\n\t\treturn <p>some text</p>\n\t}\n}\n\nclass Home extends React.Component {\n\tconstructor(props) {\n\t\t super();\n\t\t console.log('home-init');\n\t\t this.state = {popout: null, history: [], disabled: false, token: null};\n\t\t this.props = props\n\t\t console.log(this.props)\n\t\t this.create_alert = this.create_alert.bind(this);\n\t\t this.prepare_alert = this.prepare_alert.bind(this);\n\t\t //this.add_chat_message = this.add_chat_message.bind(this);\n\t\t this.get_reply_to = this.get_reply_to.bind(this);\n\t\t this.handle_send_message = this.handle_send_message.bind(this);\n\t \t this.rollback_dialog = this.rollback_dialog.bind(this);\n\t \t this.remove_alert = this.remove_alert.bind(this);\n\t\t this.message2Cell = this.message2Cell.bind(this);\n\t\t this.onHandleFormChange = this.onHandleFormChange.bind(this);\n\t\t this.onHandleFormSubmit = this.onHandleFormSubmit.bind(this);\n\t\t this.get_new_dialog = this.get_new_dialog.bind(this);\n\t\t this.get_score = this.get_score.bind(this);\n\t\t this.get_chat_history = this.get_chat_history.bind(this);\n\t\t this.isTooltipClosed = this.isTooltipClosed.bind(this);\n\t\t this.closeTooltip = this.closeTooltip.bind(this);\n\t\t this.create_feedback_panel = this.create_feedback_panel.bind(this);\n\t\t this.renderFeedbackPanel = this.renderFeedbackPanel.bind(this);\n\n\t \t this.get_chat_history().then(history => {\n\t\t\t if (history.length == 0) {\n\t\t\t\t this.get_new_dialog().then(history => {this.setState({history: history})});\n\t\t \t } else {\n\t\t\t\t \tthis.setState({history: history});\n\t\t\t }\n\t\t});\n\t}\n\n\tasync get_chat_history() {\n\t\tif (this.props.token === \"not-obtained\") {\n\t\t\treturn []\n\t\t}\n\t\tconsole.log('get---user ' + this.props.token)\n\t\tvar json = await fetch(SERVER_URL + 'user?' + new URLSearchParams({token: this.props.token}));\n\t\tvar formatted_list = []\n\t\tjson = await json.json();\n\t\tconsole.log(json)\n\t\tvar last_dialog = json.user.last_dialog;\n\t\tconsole.log(last_dialog);\n\t\tif (last_dialog == null) {\n\t\t\treturn [];\n\t\t}\n\t\tfor (var i = 0; i < last_dialog.length; i += 1) {\n\t\t\tformatted_list.push({'text': last_dialog[i], 'actor': i % 2})\n\t\t}\n\t\tconsole.log('last_dialog ' + formatted_list);\n\t\treturn formatted_list\n\t}\n\n\tasync get_new_dialog() {\n\t\tconsole.log(\"get_new_dialog \");\n\t\tconst token = this.props.token;\n\t\tif (token == 'not-obtained') {\n\t\t\treturn []\n\t\t}\n\t\tvar response = await fetch(SERVER_URL + 'start_dialog', {method: 'POST',\n\t\t\t\t\t\t\t\t\t\t\tbody: JSON.stringify({'token': token})});\n\t\tvar json = await response.json();\n\t\tvar text = json['first_message']\n\t\tvar chat_history = [{'actor': 0, 'text': text}];\n\t\tlocalStorage.setItem('chat_history', JSON.stringify(chat_history));\n\t\treturn chat_history;\n\t}\n\n\tasync get_score(history) {\n\t\tconst token = this.props.token;\n\t\tvar response = await fetch(SERVER_URL + 'finish_dialog', {method: 'POST',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'token': token\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}})\n\t\tvar json = await response.json();\n\t\tconsole.log('get_score ' + json)\n\t\treturn json['metrics'];\n\t}\n\n\tasync get_reply_to(msg) {\n\t\tvar history = this.state.history;\n\t\thistory.push({'text': msg, 'actor': 1});\n\t\tconsole.log(history);\n\t\tthis.setState({history: history, disabled: true});\n\n\t\tfetch(\n\t\t\tSERVER_URL + 'reply',\n\t\t\t{\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify(\n\t\t\t\t\t{\n\t\t\t\t\t\t'token': this.props.token,\n\t\t\t\t\t\t'message': msg\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t}\n\t\t\t}\n\t\t).then(result => {\n\t\t\tthis.get_chat_history().then(\n\t\t\t\thistory => this.setState({history: history, disabled: false})\n\t\t\t);\n\t\t});\n\t\tconsole.log(this.state);\n\t}\n\n\thandle_send_message() {\n\t\treturn;\n\t\tthis.add_chat_message(this.state.user_message, 1);\n\t\tthis.get_reply_to(\"\");\n\t}\n\n \tasync rollback_dialog() {\n\t\t// send request to server\n\t\tthis.setState({disabled: true})\n\t\tvar response = await fetch(SERVER_URL + 'rollback',\n\t\t\t\t\t\t\t\t\t\t\t\t\t{method: 'POST',\n\t\t\t\t\t\t\t\t\t\t\t\t\t body: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'token': this.props.token\n\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t\t\t\t\t\t\t\t}});\n\t\tvar chat_history = await this.get_chat_history();\n\t\tthis.setState({history: chat_history, disabled: false});\n\t}\n\n\tremove_alert(flag) {\n\t\tconsole.log('remove alert');\n\t\tif (flag) {\n\t\t\tthis.get_new_dialog().then(history => {this.setState({popout: null, history: history})});\n\t\t} else {\n\t\t\tthis.setState({popout: null});\n\t\t}\n\t\t//get_new_dialog().then(history => {this.setState({history: history})});\n\t}\n\n\trenderMessage(message) {\n\t\tconsole.log(\"renderMessage \" + JSON.stringify(message));\n\t\tif (message['actor'] == 0) {\n\t\t\treturn <Card mode=\"shadow\" size='l'>{this.message2Cell(message)}</Card>\n\t\t}\n\t\tif (message['mistakes'].length == 0) {\n\t\t\treturn <Card mode=\"tint\" size='l'>{this.message2Cell(message)}</Card>\n\t\t}\n\t\tconsole.log(message['mistakes']);\n\t\tvar text = \"\";\n\t\tmessage['mistakes'].forEach((item, i) => {\n\t\t\t\ttext += '«' + item['word'] + '» портит показатель «' + item['metric'] + '»\\n';\n\t\t});\n\t\tconsole.log(text);\n\t\t// this.setState({ tooltip: this.state.tooltip + 1})\n\t\tvar element =  <Tooltip\n\t\t\t\t\t\t\t\t\t\t\ttext={text}\n\t\t\t\t\t\t\t\t\t\t\tisShown={this.state.tooltip == message['ind']}\n\t\t\t\t\t\t\t \t\t\t\tonClose={() => this.setState({tooltip: this.state.tooltip + 1})}\n\t\t\t\t\t\t\t\t\t\t\toffsetX={10}\n\t\t\t\t\t \t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Cell><Card mode=\"tint\" size='l'>{this.message2Cell(message)}</Card></Cell>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\tconsole.log(element);\n\n\t\treturn element;\n\n\t}\n\n\trenderFeedbackPanel() {\n\t\treturn <Panel id={this.props.id}>\n\t\t\t\t\t\t\t\t<Div id=\"chat-parent\">\n\t\t\t\t\t\t\t\t\t\t{this.history.map(message =>\n\t\t\t\t\t\t\t\t\t\t\tthis.renderMessage(message))}\n\t\t\t\t\t\t\t\t</Div>\n\t\t\t\t\t\t\t\t<Div style={{height: \"50px\"}}></Div>\n\n\t\t\t\t\t\t\t\t<FixedLayout vertical=\"bottom\">\n\t\t\t\t\t\t\t\t\t <Button size=\"xl\" mode=\"secondary\" onClick={() => this.remove_alert(1)}>Все понятно</Button>\n\t\t\t\t\t\t\t\t</FixedLayout>\n\t\t\t\t\t</Panel>\n\n\t}\n\n\tcreate_feedback_panel() {\n\t\tvar scores = this.scores;\n\t\tvar history = this.state.history;\n\t\tconsole.log('create_feedback_panel');\n\t\tconsole.log(history);\n\t\tconsole.log(scores);\n\t\tthis.history = this.state.history;\n\t\tlet ind = 0;\n\t\tlet hint_count = 0;\n\t\tfor(var i = 0; i < this.history.length; i += 1) {\n\t\t\tconsole.log(i);\n\t\t\tif (this.history[i]['actor'] == 0) {this.history[i]['mistakes'] = []}\n\t\t\telse {\n\t\t\t\tvar mistakes = [];\n\t\t\t\tthis.history[i]['ind'] = ind;\n\t\t\t\tscores.forEach(element => {\n\t\t\t\t\tvar metric = element['metric'];\n\t\t\t\t\telement['mistakes'].forEach(mistake => {\n\t\t\t\t\t\tif (mistake[0] === ind) {\n\t\t\t\t\t\t\tmistakes.push({'metric': metric, 'word': mistake[1]});\n\t\t\t\t\t\t\thint_count += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\tthis.history[i]['mistakes'] = mistakes;\n\t\t\t\tind += 1;\n\t\t\t}\n\t\t}\n\t\tconsole.log('hint_count ' + hint_count);\n\t\tif (hint_count == 0) {\n\t\t\tconsole.log('hint_count == 0')\n\t\t\tthis.remove_alert(1);\n\t\t\treturn;\n\t\t}\n\t\tthis.setState({popout: \"feedback\", tooltip: 0});\n\t}\n\n\tcreate_alert(scores) {\n\t\tconsole.log(\"dialog scores\");\n\t\tconsole.log(scores);\n\t\tif (scores[0]['score'] < 0) {\n\t\t\t\ttext = <p>К сожалению, у нас пока нет нормальных критериев оценки на английском. Через пару дней все изменится</p>\n\t\t} else {\n\t\t\tvar text = <p>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tscores.map(element => <p>Ваши баллы за {element['metric']}: {element['score']}<br/></p>)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t </p>\n\t\t}\n\t\tthis.scores = scores;\n\t\tvar alert_element = (<Alert id=\"end-of-dialog-alert\" actionsLayout=\"vertical\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t actions={[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t title: 'Продолжить',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t autoclose: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t mode: 'default',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t action: () => {},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t]}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \tonClose={() => this.create_feedback_panel()}>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h2>Завершение диалога</h2>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{text}\n\t\t\t\t\t\t\t\t\t\t\t\t</Alert>);\n\t\tthis.setState({popout: alert_element});\n\t}\n\n \tasync prepare_alert() {\n\t\tthis.setState({disabled: true, popout: \"loading\"});\n\t\tvar chat_history = await this.get_chat_history();\n\t\tthis.setState({history: chat_history});\n\t\tthis.get_score(chat_history).then((response) => {\n\t\t\tthis.setState({disabled: false})\n\t\t\tconsole.log(response);\n\t\t\tvar dict = [{'metric': 'вежливость', 'score': (2 + 3 * response['politeness']['score']).toFixed(2), 'mistakes': response['politeness']['mistakes']},\n\t\t\t\t\t\t\t\t\t{'metric': 'позитивность', 'score': (2  + 3 * response['positivity']['score']).toFixed(2), 'mistakes': response['positivity']['mistakes']}];\n\t\t\tthis.create_alert(dict);\n\t\t});\n\t}\n\n\tmessage2Cell(message) {\n\t\tif (message['actor'] == 0) {\n\t\t\treturn <Cell multiline before={<Avatar src={require(\"../img/communicabio.svg\")}/>}>\n\t\t\t\t\t\t\t\t{message['text']}\n\t\t\t\t\t\t\t</Cell>\n\t\t} else {\n\t\t\treturn <Cell multiline>{message['text']}</Cell>\n\t\t}\n\t}\n\n\tonHandleFormChange(e) {\n\t\tthis.setState({\n\t\t user_message: e.target.value\n\t });\n\t}\n\n\tonHandleFormSubmit(e) {\n\t\te.preventDefault();\n\t\tconst text = this.state.user_message;\n\t\tconsole.log(text);\n\t\tthis.get_reply_to(text);\n\t\t//this.setState({user_message: \"\"});\n\t\t//console.log('user-message: ' + this.state.user_message);\n\t}\n\n\tisTooltipClosed(i) {\n\t\tvar array = this.state.tooltips;\n\t\tfor (var j = 0; j < array.length; j += 1) {\n\t\t\tif (array[j] == i) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tcloseTooltip(i) {\n\t\tvar array = this.state.tooltips;\n\t\tvar repl = []\n\t\tfor (var j = 0; j < array.length; j += 1) {\n\t\t\tif (array[j] != i) repl.push(array[j]);\n\t\t}\n\t\tif (repl.length == 0) {\n\n\t\t}\n\t\tthis.setState({tooltips: repl});\n\t}\n\n\tloadigRender() {\n\t\treturn <Panel id={this.props.id}>\n \t\t\t\t\t\t<PanelHeader>Чат</PanelHeader>\n\t\t\t\t\t\t<Spinner size=\"large\" style={{ marginTop: 50 }} />\n\t\t \t\t\t\t</Panel>\n\t}\n\n\tchatRender() {\n\t\treturn <Panel id={this.props.id}>\n\t\t\t<PanelHeader>Чат</PanelHeader>\n\t\t\t{/*{fetchedUser &&\n\t\t\t<Group title=\"User Data Fetched with VK Bridge\">\n\t\t\t\t<Cell\n\t\t\t\t\tbefore={fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\n\t\t\t\t\tdescription={fetchedUser.city && fetchedUser.city.title ? fetchedUser.city.title : ''}\n\t\t\t\t>\n\t\t\t\t\t{`${fetchedUser.first_name} ${fetchedUser.last_name}`}\n\t\t\t\t</Cell>/* Chat containers </Group>}*/}\n\t\t\t<Div id=\"chat-parent\">\n\t\t\t\t\t{this.state['history'].map(message =>\n\t\t\t\t\t\t<Card mode={{0: \"shadow\", 1: \"tint\"}[message['actor']]} size='l'>\n\t\t\t\t\t\t\t{this.message2Cell(message)}\n\t\t\t\t\t\t </Card>\n\t\t\t\t\t)}\n\t\t\t\t\t{/*renderMessages(this.state['history'], this.state['hints'])*/}\n\n\n\t\t\t</Div>\n\n\t\t\t<Div style={{height: \"130px\"}}></Div>\n\n\n\t\t\t<FixedLayout vertical=\"bottom\">\n\t\t\t\t<Div>\n\t\t\t\t\t<Div style={{display: 'flex'}}>\n\t\t       <Button size=\"l\" stretched style={{ marginRight: 8 }}\n\t\t\t\t\t \t\t\t\tbefore={<Icon24ArrowUturnLeftOutline/>} disabled={this.state.disabled} onClick={() => this.rollback_dialog(this)}>Отмена</Button>\n\t\t       <Button size=\"l\" stretched mode=\"secondary\" disabled={this.state.disabled} before={<Icon24Cancel/>} onClick={this.prepare_alert}>Закончить</Button>\n\t\t     \t</Div>\n\t\t\t\t\t<Separator/>\n\t\t\t\t\t<Div style={{'position': 'relative'}}>\n\t\t\t\t\t\t<Textarea style={{\"float\": \"left\", 'marginBottom': \"10px\", \"marginRight\": \"10px\"}} onChange={this.onHandleFormChange} defaultValue={this.state.user_message}></Textarea>\n\t\t\t\t\t\t<Button onClick={this.onHandleFormSubmit} disabled={this.state.disabled} before={<Icon24Send/>} style={{\"float\": \"left\"}}></Button>\n\t\t\t\t\t</Div>\n\t\t\t\t</Div>\n\t\t\t</FixedLayout>\n\t\t</Panel>\n\t}\n\n  render() {\n\t\tconsole.log('home-render')\n\t\tconsole.log(this.props);\n\t\t//console.log(this.state.popout == null)\n\t\t/*this.history = [{'text': \"dddgggg\", \"actor\": 1, \"mistakes\": [{\"metric\": \"m\", \"word\": \"w\"}]}];\n\t\treturn this.renderFeedbackPanel()*/\n\n\t\tif (this.state.popout == null) {\n\t\t\treturn this.chatRender();\n\t\t} else {\n\t\t\tif (this.state.popout === \"feedback\") {\n\t\t\t\treturn this.renderFeedbackPanel();\n\t\t\t}\n\t\t\tif (this.state.popout === \"loading\") {\n\t\t\t\treturn this.loadigRender();\n\t\t\t}\n\t\t\treturn this.state.popout;\n\t\t}\n\t}\n}\n\n/*Home.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n\tfetchedUser: PropTypes.shape({\n\t\tphoto_200: PropTypes.string,\n\t\tfirst_name: PropTypes.string,\n\t\tlast_name: PropTypes.string,\n\t\tcity: PropTypes.shape({\n\t\t\ttitle: PropTypes.string,\n\t\t}),\n\t}),\n\ttoken: PropTypes.string.isRequired\n};*/\n\nexport default Home;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\nimport List from '@vkontakte/vkui/dist/components/List/List'\nimport FormLayout from '@vkontakte/vkui/dist/components/FormLayout/FormLayout'\nimport Textarea from '@vkontakte/vkui/dist/components/Textarea/Textarea'\nimport Card from '@vkontakte/vkui/dist/components/Card/Card'\nimport CardGrid from '@vkontakte/vkui/dist/components/CardGrid/CardGrid'\nimport Input from '@vkontakte/vkui/dist/components/Input/Input'\nimport Separator from '@vkontakte/vkui/dist/components/Separator/Separator'\nimport Alert from '@vkontakte/vkui/dist/components/Alert/Alert'\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell'\nimport Icon24Send from '@vkontakte/icons/dist/24/send';\nimport Icon24ArrowUturnLeftOutline from '@vkontakte/icons/dist/24/arrow_uturn_left_outline';\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\nimport ReactDOM from 'react-dom'\nimport Icon16Up from '@vkontakte/icons/dist/16/up';\nimport Icon16Down from '@vkontakte/icons/dist/16/down';\nimport Icon20HomeOutline from '@vkontakte/icons/dist/20/home_outline';\nimport SERVER_URL from './Params'\nimport {FixedLayout} from '@vkontakte/vkui'\n\nclass Rating extends React.Component {\n\tconstructor(props) {\n\t\t super();\n\t\t this.N = 8;\n\t\t this.M = 20;\n\t\t this.props = props;\n\t\t this.state = {place: 0, our_place: 100000000, table: []};\n\t\t this.changePlace(0);\n\n\t\t console.log(this.props);\n\t\t this.getUserInfo = this.getUserInfo.bind(this);\n\t\t this.renderRating = this.renderRating.bind(this);\n\t\t this.getRatingTable = this.getRatingTable.bind(this);\n\t\t this.changePlace = this.changePlace.bind(this);\n\t\t this.goHome = this.goHome.bind(this);\n\t}\n\n\tasync getUserInfo() {\n\t\tlet response = await fetch(SERVER_URL + 'user?' + new URLSearchParams({token: this.props.token}));\n\t\treturn await response.json();\n\t}\n\n\tasync getRatingTable(start, end) {\n\t\tconsole.log('start ' + start + ' end ' + end);\n\t\tvar response = await fetch(SERVER_URL + 'rating?' + new URLSearchParams({'n': start, 'm': end, 'token': this.props.token}));\n\t\tvar json = await response.json();\n\t\tconsole.log('getRatingTable');\n\t\tconsole.log(json);\n\t\tfor(var i = 0; i < json.rating.length; i += 1) {\n\t\t\tjson.rating[i]['place'] = start + i + 1;\n\t\t}\n\t\tconsole.log('places..')\n\t\tconsole.log(json.rating)\n\t\treturn json.rating;\n\t}\n\n\trenderRating(place, table) {\n\t\tconsole.log('renderRating');\n\t\tconsole.log(place);\n\t\tconsole.log(table);\n\t\treturn (\n\t\t\t<CardGrid>\n\t\t\t\t{table.map(entry => {\n\t\t\t\t\treturn <Card size='l' mode={{0: \"shadow\", 1: \"tint\"}[place != entry['place']]}>\n\t\t\t\t\t\t<Div style={{\"float\": \"left\"}}>{entry['place']}е</Div>\n\t\t\t\t\t\t<Div style={{\"float\": \"left\"}}>{entry['name']}</Div>\n\t\t\t\t\t\t<Div style={{\"float\": \"right\"}}>{entry['avg_score'].toFixed(2)}</Div>\n\t\t\t\t\t</Card>}\n\t\t\t\t)}\n\t\t\t</CardGrid>\n\t\t);\n\t}\n\n\tasync changePlace(delta) {\n\t\tconsole.log('changePlace ' + delta);\n\t\tvar info = await this.getUserInfo();\n\t\tvar our_place = info['place'];\n\t\tvar place = Math.max(0, this.state.place + delta);\n\t\tvar table = await this.getRatingTable(place, place + this.N - 1);\n\t\tconsole.log('table ' + table);\n\t\tthis.setState({table: table, our_place: our_place, place: place});\n\t\tconsole.log(this)\n\t}\n\n\tasync goHome() {\n\t\tvar info = await this.getUserInfo();\n\t\tvar our_place = info.user.place;\n\t\tvar place = Math.max(0, our_place - this.N / 2);\n\t\tvar table = await this.getRatingTable(place, place + this.N - 1);\n\t\tthis.setState({table: table, our_place: our_place, place: place});\n\t\tconsole.log(this)\n\t}\n\n  render() {\n\t\tconsole.log('rating_render')\n\t\treturn (\n\t\t<Panel id={this.props.id}>\n\t\t\t\t<PanelHeader>Рейтинг</PanelHeader>\n\t\t\t\t{/*{fetchedUser &&\n\t\t\t\t<Group title=\"User Data Fetched with VK Bridge\">\n\t\t\t\t\t<Cell\n\t\t\t\t\t\tbefore={fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\n\t\t\t\t\t\tdescription={fetchedUser.city && fetchedUser.city.title ? fetchedUser.city.title : ''}\n\t\t\t\t\t>\n\t\t\t\t\t\t{`${fetchedUser.first_name} ${fetchedUser.last_name}`}\n\t\t\t\t\t</Cell>/* Chat containers </Group>}*/}\n\t\t\t\t{this.renderRating(this.state.place, this.state.table)}\n\t\t\t\t<FixedLayout vertical=\"bottom\">\n\t\t\t\t\t<Div style={{display: 'flex'}}>\n\t\t\t\t\t\t <Button size=\"l\" stretched style={{ marginRight: 8 }}\n\t\t\t\t\t\t\t\t\t\tbefore={<Icon16Up/>} onClick={() => {this.changePlace(-1)}}></Button>\n\t\t\t\t\t\t <Button size=\"l\" stretched style={{ marginRight: 8 }} mode=\"secondary\"\n\t\t\t\t\t\t\t\t\t\tbefore={<Icon20HomeOutline/>} onClick={this.goHome}>Мое место</Button>\n\t\t\t\t\t\t <Button size=\"l\" stretched style={{ marginRight: 8 }}\n\t\t\t\t\t\t\t\t\t\tbefore={<Icon16Down/>} onClick={() => {this.changePlace(1)}}></Button>\n\t\t\t\t\t</Div>\n\t\t\t\t</FixedLayout>\n\t\t\t</Panel>);\n\t\t}\n}\n\nRating.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n\tfetchedUser: PropTypes.shape({\n\t\tphoto_200: PropTypes.string,\n\t\tfirst_name: PropTypes.string,\n\t\tlast_name: PropTypes.string,\n\t\tcity: PropTypes.shape({\n\t\t\ttitle: PropTypes.string,\n\t\t}),\n\t}),\n};\n\nexport default Rating;\n","import React from 'react';\nimport connect from '@vkontakte/vkui-connect';\nimport { View, Epic, Tabbar, TabbarItem, Panel, PanelHeader, Spinner } from '@vkontakte/vkui';\nimport '@vkontakte/vkui/dist/vkui.css';\nimport Icon28ChatsOutline from '@vkontakte/icons/dist/28/chats_outline';\nimport Icon28ListOutline from '@vkontakte/icons/dist/28/list_outline';\n\nimport Home from './panels/Home';\nimport Rating from './panels/Rating';\nimport SERVER_URL from './panels/Params'\n\nclass App extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tactivePanel: 'home',\n\t\t\tfetchedUser: null,\n\t\t\tactiveStory: 'chat',\n\t\t\ttoken: \"not-obtained\",\n\t\t};\n\t\tthis.renderHome = this.renderHome.bind(this);\n\t\tthis.renderRating = this.renderRating.bind(this);\n\t\tthis.onStoryChange = this.onStoryChange.bind(this);\n\t\tthis.parseQueryString = this.parseQueryString.bind(this);\n\t\tthis.obtainToken = this.obtainToken.bind(this);\n\t}\n\n\tparseQueryString = (string) => {\n        return string.slice(1).split('&')\n            .map((queryParam) => {\n                let kvp = queryParam.split('=');\n                return {key: kvp[0], value: kvp[1]}\n            })\n            .reduce((query, kvp) => {\n                query[kvp.key] = kvp.value;\n                return query\n            }, {})\n    };\n\n\n\tcomponentDidMount() {\n\t\tthis.obtainToken();\n\t}\n\n\tgo = (e) => {\n\t\tthis.setState({ activePanel: e.currentTarget.dataset.to })\n\t};\n\n  onStoryChange(e) {\n    this.setState({ activeStory: e.currentTarget.dataset.story });\n  }\n\n\tasync obtainToken() {\n\t\tconst urlParams = window.location.search;\n\t\tlet req_params = {'data': urlParams};\n\t\t//console.log(\"req_params \" + req_params);\n\t\treq_params = JSON.stringify(req_params);\n\t\tvar result = await fetch(SERVER_URL + 'token',\n\t\t\t\t\t{\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tbody: req_params,\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\tvar json = await result.json()\n\t\tthis.setState({token: json['token']});\n\t\tconsole.log('!!!!!!!!!!!!TOKEN!!!!!!!!!!!!!!!!');\n\t\tconsole.log(json['token']);\n\t}\n\n\trenderHome() {\n\t\tif (this.state.token != 'not-obtained') {\n\t\t\treturn <Home id=\"home\" fetchedUser={this.state.fetchedUser} go={this.go} token={this.state.token}/>\n\t\t} else {\n\t\t\treturn <Panel id=\"home\">\n\t\t\t\t\t\t<Spinner size=\"large\" style={{ marginTop: 50 }} />\n\t\t\t\t\t\t</Panel>;\n\t\t}\n\t}\n\n\trenderRating() {\n\t\tif (this.state.token != 'not-obtained') {\n\t\t\treturn <Rating id=\"rating\" fetchedUser={this.state.fetchedUser} go={this.go} token={this.state.token}/>\n\t\t} else {\n\t\t\treturn <Panel id=\"rating\"></Panel>\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<Epic activeStory={this.state.activeStory} tabbar={\n        <Tabbar>\n          <TabbarItem\n            onClick={this.onStoryChange}\n            selected={this.state.activeStory === 'chat'}\n            data-story=\"chat\"\n            text=\"Чат\"\n          ><Icon28ChatsOutline /></TabbarItem>\n          <TabbarItem\n            onClick={this.onStoryChange}\n            selected={this.state.activeStory === 'rating-view'}\n            data-story=\"rating-view\"\n            text=\"Рейтинг\"\n          ><Icon28ListOutline /></TabbarItem>\n\t\t\t\t</Tabbar>}>\n\t\t\t<View id=\"chat\" activePanel={this.state.activePanel}>\n\t\t\t\t{this.renderHome()}\n\t\t\t</View>\n\t\t\t<View id=\"rating-view\" activePanel=\"rating\">\n\t\t\t\t{this.renderRating()}\n\t\t\t</View>\n\t\t</Epic>\n\t\t);\n\t}\n}\n\nexport default App;\n","import 'core-js/es6/map';\nimport 'core-js/es6/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vkui-connect';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK App\nconnect.send('VKWebAppInit', {});\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}