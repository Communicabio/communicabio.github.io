{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _classNames = _interopRequireDefault(require(\"../../lib/classNames\"));\n\nvar _getClassName = _interopRequireDefault(require(\"../../helpers/getClassName\"));\n\nvar _Tappable = _interopRequireDefault(require(\"../Tappable/Tappable\"));\n\nvar _Touch = _interopRequireDefault(require(\"../Touch/Touch\"));\n\nvar _platform = require(\"../../lib/platform\");\n\nvar _chevron = _interopRequireDefault(require(\"@vkontakte/icons/dist/24/chevron\"));\n\nvar _done = _interopRequireDefault(require(\"@vkontakte/icons/dist/16/done\"));\n\nvar _cancel = _interopRequireDefault(require(\"@vkontakte/icons/dist/24/cancel\"));\n\nvar _reorder = _interopRequireDefault(require(\"@vkontakte/icons/dist/24/reorder\"));\n\nvar _reorder_ios = _interopRequireDefault(require(\"@vkontakte/icons/dist/24/reorder_ios\"));\n\nvar _withPlatform = _interopRequireDefault(require(\"../../hoc/withPlatform\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _createSuper(Derived) {\n  return function () {\n    var Super = (0, _getPrototypeOf2.default)(Derived),\n        result;\n\n    if (_isNativeReflectConstruct()) {\n      var NewTarget = (0, _getPrototypeOf2.default)(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2.default)(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar Cell = /*#__PURE__*/function (_Component) {\n  (0, _inherits2.default)(Cell, _Component);\n\n  var _super = _createSuper(Cell);\n\n  function Cell(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, Cell);\n    _this = _super.call(this, props);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"rootEl\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"removeButton\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onClick\", function (e) {\n      var _this$props = _this.props,\n          removable = _this$props.removable,\n          onClick = _this$props.onClick;\n      var target = e.target;\n\n      if (target.tagName.toLowerCase() === 'input') {\n        e.stopPropagation();\n      } else if (removable) {\n        return null;\n      } else {\n        onClick && onClick(e);\n      }\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"activateRemove\", function () {\n      _this.setState({\n        isRemoveActivated: true\n      });\n\n      _this.document.addEventListener('click', _this.deactivateRemove);\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"deactivateRemove\", function () {\n      _this.setState({\n        isRemoveActivated: false,\n        removeOffset: 0\n      });\n\n      _this.document.removeEventListener('click', _this.deactivateRemove);\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onRemoveClick\", function (e) {\n      e.nativeEvent.stopImmediatePropagation();\n      e.preventDefault();\n      _this.props.onRemove && _this.props.onRemove(e, _this.rootEl);\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"getRemoveRef\", function (el) {\n      return _this.removeButton = el;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"getRootRef\", function (element) {\n      _this.rootEl = element;\n      var getRootRef = _this.props.getRootRef;\n\n      if (getRootRef) {\n        if (typeof getRootRef === 'function') {\n          getRootRef(element);\n        } else {\n          getRootRef.current = element;\n        }\n      }\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"dragShift\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"listEl\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"siblings\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"dragStartIndex\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"dragEndIndex\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"dragDirection\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onDragStart\", function () {\n      _this.setState({\n        dragging: true\n      });\n\n      _this.dragShift = 0;\n      _this.listEl = _this.rootEl.closest('.List');\n      _this.listEl && _this.listEl.classList.add('List--dragging');\n      _this.siblings = Array.prototype.slice.call(_this.rootEl.parentElement.childNodes);\n      _this.dragStartIndex = _this.siblings.indexOf(_this.rootEl);\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onDragMove\", function (e) {\n      e.originalEvent.preventDefault();\n\n      if (_this.state.removeOffset) {\n        return;\n      }\n\n      _this.rootEl.style.transform = \"translateY(\".concat(e.shiftY, \"px)\");\n\n      var rootGesture = _this.rootEl.getBoundingClientRect();\n\n      _this.dragDirection = _this.dragShift - e.shiftY < 0 ? 'down' : 'up';\n      _this.dragShift = e.shiftY;\n      _this.dragEndIndex = _this.dragStartIndex;\n\n      _this.siblings.forEach(function (sibling, siblingIndex) {\n        var siblingGesture = sibling.getBoundingClientRect();\n\n        if (_this.dragStartIndex < siblingIndex) {\n          if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2) {\n            if (_this.dragDirection === 'down') {\n              sibling.style.transform = 'translateY(-100%)';\n            }\n\n            _this.dragEndIndex++;\n          }\n\n          if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2 && _this.dragDirection === 'up') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        } else if (_this.dragStartIndex > siblingIndex) {\n          if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2) {\n            if (_this.dragDirection === 'up') {\n              sibling.style.transform = 'translateY(100%)';\n            }\n\n            _this.dragEndIndex--;\n          }\n\n          if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2 && _this.dragDirection === 'down') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        }\n      });\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onDragEnd\", function () {\n      _this.setState({\n        dragging: false\n      });\n\n      _this.listEl && _this.listEl.classList.remove('List--dragging');\n      _this.props.onDragFinish && _this.props.onDragFinish({\n        from: _this.dragStartIndex,\n        to: _this.dragEndIndex\n      });\n\n      _this.siblings.forEach(function (sibling) {\n        return sibling.style.transform = null;\n      });\n\n      delete _this.dragShift;\n      delete _this.listEl;\n      delete _this.siblings;\n      delete _this.dragStartIndex;\n      delete _this.dragEndIndex;\n      delete _this.dragDirection;\n    });\n    _this.state = {\n      isRemoveActivated: false,\n      removeOffset: 0,\n      dragging: false\n    };\n    return _this;\n  }\n\n  (0, _createClass2.default)(Cell, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.document.removeEventListener('click', this.deactivateRemove);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(_prevProps, prevState) {\n      if (prevState.isRemoveActivated !== this.state.isRemoveActivated && this.state.isRemoveActivated) {\n        this.setState({\n          removeOffset: this.removeButton.offsetWidth\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props2 = this.props,\n          before = _this$props2.before,\n          indicator = _this$props2.indicator,\n          asideContent = _this$props2.asideContent,\n          expandable = _this$props2.expandable,\n          onClick = _this$props2.onClick,\n          children = _this$props2.children,\n          getRootRef = _this$props2.getRootRef,\n          description = _this$props2.description,\n          selectable = _this$props2.selectable,\n          multiline = _this$props2.multiline,\n          className = _this$props2.className,\n          onRemove = _this$props2.onRemove,\n          removable = _this$props2.removable,\n          removePlaceholder = _this$props2.removePlaceholder,\n          draggable = _this$props2.draggable,\n          onDragFinish = _this$props2.onDragFinish,\n          href = _this$props2.href,\n          size = _this$props2.size,\n          bottomContent = _this$props2.bottomContent,\n          platform = _this$props2.platform,\n          onChange = _this$props2.onChange,\n          restProps = (0, _objectWithoutProperties2.default)(_this$props2, [\"before\", \"indicator\", \"asideContent\", \"expandable\", \"onClick\", \"children\", \"getRootRef\", \"description\", \"selectable\", \"multiline\", \"className\", \"onRemove\", \"removable\", \"removePlaceholder\", \"draggable\", \"onDragFinish\", \"href\", \"size\", \"bottomContent\", \"platform\", \"onChange\"]);\n      selectable = selectable && !draggable;\n      var rootProps = selectable ? {} : restProps;\n      var inputProps = selectable ? _objectSpread({}, restProps, {\n        onChange: onChange\n      }) : {};\n      var linkProps = href ? restProps : {};\n      var IS_PLATFORM_ANDROID = platform === _platform.ANDROID;\n      var IS_PLATFORM_IOS = platform === _platform.IOS;\n      return /*#__PURE__*/_react.default.createElement(\"div\", (0, _extends2.default)({}, rootProps, {\n        onClick: href || draggable ? null : this.onClick,\n        className: (0, _classNames.default)((0, _getClassName.default)('Cell', platform), {\n          'Cell--expandable': expandable,\n          'Cell--multiline': multiline,\n          'Cell--dragging': this.state.dragging,\n          'Cell--draggable': draggable\n        }, \"Cell--\".concat(size), className),\n        ref: this.getRootRef\n      }), /*#__PURE__*/_react.default.createElement(_Tappable.default, (0, _extends2.default)({}, linkProps, {\n        onClick: href ? this.onClick : null,\n        Component: selectable ? 'label' : href ? 'a' : 'div',\n        className: \"Cell__in\",\n        href: href,\n        disabled: !selectable && !onClick && !href || removable || draggable,\n        style: removable ? {\n          transform: \"translateX(-\".concat(this.state.removeOffset, \"px)\")\n        } : null\n      }), selectable && /*#__PURE__*/_react.default.createElement(\"input\", (0, _extends2.default)({}, inputProps, {\n        type: \"checkbox\",\n        className: \"Cell__checkbox\"\n      })), /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__before\"\n      }, selectable && IS_PLATFORM_IOS && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__checkbox-marker\"\n      }, /*#__PURE__*/_react.default.createElement(_done.default, null)), removable && IS_PLATFORM_IOS && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__remove-marker\",\n        onClick: this.activateRemove\n      }), IS_PLATFORM_ANDROID && draggable && /*#__PURE__*/_react.default.createElement(_Touch.default, {\n        onStart: this.onDragStart,\n        onMoveY: this.onDragMove,\n        onEnd: this.onDragEnd,\n        className: \"Cell__dragger\"\n      }, /*#__PURE__*/_react.default.createElement(_reorder.default, null)), before && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__before-in\"\n      }, before)), /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__main\"\n      }, /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__children\"\n      }, children), description && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__description\"\n      }, description), size === 'l' && bottomContent && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__bottom\"\n      }, bottomContent)), /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__indicator\"\n      }, indicator), /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__aside\"\n      }, asideContent, selectable && IS_PLATFORM_ANDROID && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__checkbox-marker\"\n      }, /*#__PURE__*/_react.default.createElement(_done.default, null)), removable && IS_PLATFORM_ANDROID && /*#__PURE__*/_react.default.createElement(\"div\", {\n        className: \"Cell__remove-marker\",\n        onClick: this.onRemoveClick\n      }, /*#__PURE__*/_react.default.createElement(_cancel.default, null)), IS_PLATFORM_IOS && expandable && !draggable && /*#__PURE__*/_react.default.createElement(_chevron.default, {\n        className: \"Cell__chevron\"\n      }), IS_PLATFORM_IOS && draggable && /*#__PURE__*/_react.default.createElement(_Touch.default, {\n        className: \"Cell__dragger\",\n        onStart: this.onDragStart,\n        onMoveY: this.onDragMove,\n        onEnd: this.onDragEnd\n      }, /*#__PURE__*/_react.default.createElement(_reorder_ios.default, null)))), removable && IS_PLATFORM_IOS && /*#__PURE__*/_react.default.createElement(\"div\", {\n        ref: this.getRemoveRef,\n        className: \"Cell__remove\",\n        onClick: this.onRemoveClick,\n        style: removable ? {\n          transform: \"translateX(-\".concat(this.state.removeOffset, \"px)\")\n        } : null\n      }, /*#__PURE__*/_react.default.createElement(\"span\", {\n        className: \"Cell__remove-in\"\n      }, removePlaceholder)));\n    }\n  }, {\n    key: \"document\",\n    get: function get() {\n      return this.context.document || document;\n    }\n    /*\n     * предотвращает двойное срабатывание в случае с input\n     * (https://github.com/vuejs/vue/issues/3699#issuecomment-247957931)\n     * предотвращает клик в случае, когда включен режим removable\n     */\n\n  }]);\n  return Cell;\n}(_react.Component);\n\n(0, _defineProperty2.default)(Cell, \"defaultProps\", {\n  indicator: '',\n  asideContent: '',\n  expandable: false,\n  children: '',\n  selectable: false,\n  multiline: false,\n  removable: false,\n  size: 'm',\n  removePlaceholder: 'Удалить'\n});\n(0, _defineProperty2.default)(Cell, \"contextTypes\", {\n  document: _propTypes.default.any\n});\n\nvar _default = (0, _withPlatform.default)(Cell);\n\nexports.default = _default;","map":{"version":3,"sources":["../../../src/components/Cell/Cell.tsx"],"names":["Cell","Component","isRemoveActivated","removeOffset","dragging","indicator","asideContent","expandable","children","selectable","multiline","removable","size","removePlaceholder","document","PropTypes","any","onClick","target","e","_prevProps","prevState","offsetWidth","getRootRef","Array","rootGesture","siblingGesture","sibling","from","to","dragEndIndex","before","description","className","onRemove","draggable","onDragFinish","href","bottomContent","platform","onChange","restProps","rootProps","inputProps","linkProps","IS_PLATFORM_ANDROID","ANDROID","IS_PLATFORM_IOS","IOS","transform","activateRemove","onRemoveClick","onDragEnd"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,MAAA,GAAA,uBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,CAAA;;AACA,IAAA,UAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,YAAA,CAAA,CAAA;;AACA,IAAA,WAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,sBAAA,CAAA,CAAA;;AACA,IAAA,aAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,4BAAA,CAAA,CAAA;;AACA,IAAA,SAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,sBAAA,CAAA,CAAA;;AACA,IAAA,MAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,gBAAA,CAAA,CAAA;;AACA,IAAA,SAAA,GAAA,OAAA,CAAA,oBAAA,CAAA;;AACA,IAAA,QAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,kCAAA,CAAA,CAAA;;AACA,IAAA,KAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,+BAAA,CAAA,CAAA;;AACA,IAAA,OAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,iCAAA,CAAA,CAAA;;AACA,IAAA,QAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,kCAAA,CAAA,CAAA;;AACA,IAAA,YAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,sCAAA,CAAA,CAAA;;AAEA,IAAA,aAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,wBAAA,CAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA+EMA,I;;;;;AACJ,WAAA,IAAA,CAAA,KAAA,EAA8B;AAAA,QAAA,KAAA;;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,IAAA,EAAA,IAAA;AAC5B,IAAA,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,EAAA,KAAA,CAAA;AAD4B,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,QAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,cAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,SAAA,EAoCH,UAAA,CAAA,EAAsC;AAAA,UAAA,WAAA,GAChC,KAAA,CADgC,KAAA;AAAA,UACvDW,SADuD,GAAA,WAAA,CAAA,SAAA;AAAA,UAC5CM,OAD4C,GAAA,WAAA,CAAA,OAAA;AAE/D,UAAMC,MAAM,GAAGC,CAAC,CAAhB,MAAA;;AACA,UAAID,MAAM,CAANA,OAAAA,CAAAA,WAAAA,OAAJ,OAAA,EAA8C;AAC5CC,QAAAA,CAAC,CAADA,eAAAA;AADF,OAAA,MAEO,IAAA,SAAA,EAAe;AACpB,eAAA,IAAA;AADK,OAAA,MAEA;AACLF,QAAAA,OAAO,IAAIA,OAAO,CAAlBA,CAAkB,CAAlBA;AACD;AA7C2B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,gBAAA,EAgDb,YAAM;AACrB,MAAA,KAAA,CAAA,QAAA,CAAc;AAAEf,QAAAA,iBAAiB,EAAE;AAArB,OAAd;;AACA,MAAA,KAAA,CAAA,QAAA,CAAA,gBAAA,CAAA,OAAA,EAAwC,KAAA,CAAxC,gBAAA;AAlD4B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,kBAAA,EAqDX,YAAM;AACvB,MAAA,KAAA,CAAA,QAAA,CAAc;AAAEA,QAAAA,iBAAiB,EAAnB,KAAA;AAA4BC,QAAAA,YAAY,EAAE;AAA1C,OAAd;;AACA,MAAA,KAAA,CAAA,QAAA,CAAA,mBAAA,CAAA,OAAA,EAA2C,KAAA,CAA3C,gBAAA;AAvD4B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,eAAA,EA0DG,UAAA,CAAA,EAAmB;AAClDgB,MAAAA,CAAC,CAADA,WAAAA,CAAAA,wBAAAA;AACAA,MAAAA,CAAC,CAADA,cAAAA;AACA,MAAA,KAAA,CAAA,KAAA,CAAA,QAAA,IAAuB,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,CAAA,EAAuB,KAAA,CAA9C,MAAuB,CAAvB;AA7D4B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,cAAA,EA0Ef,UAAA,EAAA,EAAA;AAAA,aAAwB,KAAA,CAAA,YAAA,GAAxB,EAAA;AA1Ee,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,YAAA,EA4EjB,UAAA,OAAA,EAA0B;AACrC,MAAA,KAAA,CAAA,MAAA,GAAA,OAAA;AAEA,UAAMI,UAAU,GAAG,KAAA,CAAA,KAAA,CAAnB,UAAA;;AACA,UAAA,UAAA,EAAgB;AACd,YAAI,OAAA,UAAA,KAAJ,UAAA,EAAsC;AACpCA,UAAAA,UAAU,CAAVA,OAAU,CAAVA;AADF,SAAA,MAEO;AACLA,UAAAA,UAAU,CAAVA,OAAAA,GAAAA,OAAAA;AACD;AACF;AAtF2B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,WAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,QAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,UAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,gBAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,cAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,eAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,aAAA,EAgGhB,YAAM;AAClB,MAAA,KAAA,CAAA,QAAA,CAAc;AAAEnB,QAAAA,QAAQ,EAAE;AAAZ,OAAd;;AACA,MAAA,KAAA,CAAA,SAAA,GAAA,CAAA;AACA,MAAA,KAAA,CAAA,MAAA,GAAc,KAAA,CAAA,MAAA,CAAA,OAAA,CAAd,OAAc,CAAd;AACA,MAAA,KAAA,CAAA,MAAA,IAAe,KAAA,CAAA,MAAA,CAAA,SAAA,CAAA,GAAA,CAAf,gBAAe,CAAf;AACA,MAAA,KAAA,CAAA,QAAA,GAAgBoB,KAAK,CAALA,SAAAA,CAAAA,KAAAA,CAAAA,IAAAA,CAA2B,KAAA,CAAA,MAAA,CAAA,aAAA,CAA3C,UAAgBA,CAAhB;AACA,MAAA,KAAA,CAAA,cAAA,GAAsB,KAAA,CAAA,QAAA,CAAA,OAAA,CAAsB,KAAA,CAA5C,MAAsB,CAAtB;AAtG4B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,YAAA,EAyGjB,UAAA,CAAA,EAAmB;AAC9BL,MAAAA,CAAC,CAADA,aAAAA,CAAAA,cAAAA;;AACA,UAAI,KAAA,CAAA,KAAA,CAAJ,YAAA,EAA6B;AAC3B;AACD;;AAED,MAAA,KAAA,CAAA,MAAA,CAAA,KAAA,CAAA,SAAA,GAAA,cAAA,MAAA,CAA4CA,CAAC,CAA7C,MAAA,EAAA,KAAA,CAAA;;AACA,UAAMM,WAAW,GAAG,KAAA,CAAA,MAAA,CAApB,qBAAoB,EAApB;;AACA,MAAA,KAAA,CAAA,aAAA,GAAqB,KAAA,CAAA,SAAA,GAAiBN,CAAC,CAAlB,MAAA,GAAA,CAAA,GAAA,MAAA,GAArB,IAAA;AACA,MAAA,KAAA,CAAA,SAAA,GAAiBA,CAAC,CAAlB,MAAA;AACA,MAAA,KAAA,CAAA,YAAA,GAAoB,KAAA,CAApB,cAAA;;AAEA,MAAA,KAAA,CAAA,QAAA,CAAA,OAAA,CAAsB,UAAA,OAAA,EAAA,YAAA,EAA2B;AAC/C,YAAMO,cAAc,GAAGC,OAAO,CAA9B,qBAAuBA,EAAvB;;AACA,YAAI,KAAA,CAAA,cAAA,GAAJ,YAAA,EAAwC;AACtC,cAAIF,WAAW,CAAXA,MAAAA,GAAqBC,cAAc,CAAdA,GAAAA,GAAqBA,cAAc,CAAdA,MAAAA,GAA9C,CAAA,EAAyE;AACvE,gBAAI,KAAA,CAAA,aAAA,KAAJ,MAAA,EAAmC;AACjCC,cAAAA,OAAO,CAAPA,KAAAA,CAAAA,SAAAA,GAAAA,mBAAAA;AACD;;AACD,YAAA,KAAA,CAAA,YAAA;AACD;;AACD,cAAIF,WAAW,CAAXA,GAAAA,GAAkBC,cAAc,CAAdA,MAAAA,GAAwBA,cAAc,CAAdA,MAAAA,GAA1CD,CAAAA,IAAuE,KAAA,CAAA,aAAA,KAA3E,IAAA,EAAwG;AACtGE,YAAAA,OAAO,CAAPA,KAAAA,CAAAA,SAAAA,GAAAA,eAAAA;AACD;AATH,SAAA,MAUO,IAAI,KAAA,CAAA,cAAA,GAAJ,YAAA,EAAwC;AAC7C,cAAIF,WAAW,CAAXA,GAAAA,GAAkBC,cAAc,CAAdA,MAAAA,GAAwBA,cAAc,CAAdA,MAAAA,GAA9C,CAAA,EAAyE;AACvE,gBAAI,KAAA,CAAA,aAAA,KAAJ,IAAA,EAAiC;AAC/BC,cAAAA,OAAO,CAAPA,KAAAA,CAAAA,SAAAA,GAAAA,kBAAAA;AACD;;AACD,YAAA,KAAA,CAAA,YAAA;AACD;;AACD,cAAIF,WAAW,CAAXA,MAAAA,GAAqBC,cAAc,CAAdA,GAAAA,GAAqBA,cAAc,CAAdA,MAAAA,GAA1CD,CAAAA,IAAuE,KAAA,CAAA,aAAA,KAA3E,MAAA,EAA0G;AACxGE,YAAAA,OAAO,CAAPA,KAAAA,CAAAA,SAAAA,GAAAA,eAAAA;AACD;AACF;AAtBH,OAAA;AArH4B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,WAAA,EA+IlB,YAAM;AAChB,MAAA,KAAA,CAAA,QAAA,CAAc;AAAEvB,QAAAA,QAAQ,EAAE;AAAZ,OAAd;;AACA,MAAA,KAAA,CAAA,MAAA,IAAe,KAAA,CAAA,MAAA,CAAA,SAAA,CAAA,MAAA,CAAf,gBAAe,CAAf;AACA,MAAA,KAAA,CAAA,KAAA,CAAA,YAAA,IAA2B,KAAA,CAAA,KAAA,CAAA,YAAA,CAAwB;AAAEwB,QAAAA,IAAI,EAAE,KAAA,CAAR,cAAA;AAA6BC,QAAAA,EAAE,EAAE,KAAA,CAAKC;AAAtC,OAAxB,CAA3B;;AACA,MAAA,KAAA,CAAA,QAAA,CAAA,OAAA,CAAsB,UAAA,OAAA,EAAA;AAAA,eAAaH,OAAO,CAAPA,KAAAA,CAAAA,SAAAA,GAAb,IAAA;AAAtB,OAAA;;AACA,aAAO,KAAA,CAAP,SAAA;AACA,aAAO,KAAA,CAAP,MAAA;AACA,aAAO,KAAA,CAAP,QAAA;AACA,aAAO,KAAA,CAAP,cAAA;AACA,aAAO,KAAA,CAAP,YAAA;AACA,aAAO,KAAA,CAAP,aAAA;AAzJ4B,KAAA;AAG5B,IAAA,KAAA,CAAA,KAAA,GAAa;AACXzB,MAAAA,iBAAiB,EADN,KAAA;AAEXC,MAAAA,YAAY,EAFD,CAAA;AAGXC,MAAAA,QAAQ,EAAE;AAHC,KAAb;AAH4B,WAAA,KAAA;AAQ7B;;;;2CAwDsB;AACrB,WAAA,QAAA,CAAA,mBAAA,CAAA,OAAA,EAA2C,KAA3C,gBAAA;AACD;;;uCAEkBgB,U,EAAuBC,S,EAAsB;AAC9D,UAAIA,SAAS,CAATA,iBAAAA,KAAgC,KAAA,KAAA,CAAhCA,iBAAAA,IAAgE,KAAA,KAAA,CAApE,iBAAA,EAAkG;AAChG,aAAA,QAAA,CAAc;AAAElB,UAAAA,YAAY,EAAE,KAAA,YAAA,CAAkBmB;AAAlC,SAAd;AACD;AACF;;;6BAoFQ;AAAA,UAAA,YAAA,GAwBH,KAxBG,KAAA;AAAA,UAELS,MAFK,GAAA,YAAA,CAAA,MAAA;AAAA,UAGL1B,SAHK,GAAA,YAAA,CAAA,SAAA;AAAA,UAILC,YAJK,GAAA,YAAA,CAAA,YAAA;AAAA,UAKLC,UALK,GAAA,YAAA,CAAA,UAAA;AAAA,UAMLU,OANK,GAAA,YAAA,CAAA,OAAA;AAAA,UAOLT,QAPK,GAAA,YAAA,CAAA,QAAA;AAAA,UAQLe,UARK,GAAA,YAAA,CAAA,UAAA;AAAA,UASLS,WATK,GAAA,YAAA,CAAA,WAAA;AAAA,UAULvB,UAVK,GAAA,YAAA,CAAA,UAAA;AAAA,UAWLC,SAXK,GAAA,YAAA,CAAA,SAAA;AAAA,UAYLuB,SAZK,GAAA,YAAA,CAAA,SAAA;AAAA,UAaLC,QAbK,GAAA,YAAA,CAAA,QAAA;AAAA,UAcLvB,SAdK,GAAA,YAAA,CAAA,SAAA;AAAA,UAeLE,iBAfK,GAAA,YAAA,CAAA,iBAAA;AAAA,UAgBLsB,SAhBK,GAAA,YAAA,CAAA,SAAA;AAAA,UAiBLC,YAjBK,GAAA,YAAA,CAAA,YAAA;AAAA,UAkBLC,IAlBK,GAAA,YAAA,CAAA,IAAA;AAAA,UAmBLzB,IAnBK,GAAA,YAAA,CAAA,IAAA;AAAA,UAoBL0B,aApBK,GAAA,YAAA,CAAA,aAAA;AAAA,UAqBLC,QArBK,GAAA,YAAA,CAAA,QAAA;AAAA,UAsBLC,QAtBK,GAAA,YAAA,CAAA,QAAA;AAAA,UAuBFC,SAvBE,GAAA,CAAA,GAAA,yBAAA,CAAA,OAAA,EAAA,YAAA,EAAA,CAAA,QAAA,EAAA,WAAA,EAAA,cAAA,EAAA,YAAA,EAAA,SAAA,EAAA,UAAA,EAAA,YAAA,EAAA,aAAA,EAAA,YAAA,EAAA,WAAA,EAAA,WAAA,EAAA,UAAA,EAAA,WAAA,EAAA,mBAAA,EAAA,WAAA,EAAA,cAAA,EAAA,MAAA,EAAA,MAAA,EAAA,eAAA,EAAA,UAAA,EAAA,UAAA,CAAA,CAAA;AA0BPhC,MAAAA,UAAU,GAAGA,UAAU,IAAI,CAA3BA,SAAAA;AAEA,UAAMiC,SAAS,GAAGjC,UAAU,GAAA,EAAA,GAA5B,SAAA;AACA,UAAMkC,UAAU,GAAGlC,UAAU,GAAA,aAAA,CAAA,EAAA,EAAA,SAAA,EAAA;AAAmB+B,QAAAA,QAAQ,EAARA;AAAnB,OAAA,CAAA,GAA7B,EAAA;AACA,UAAMI,SAAS,GAAGP,IAAI,GAAA,SAAA,GAAtB,EAAA;AACA,UAAMQ,mBAAmB,GAAGN,QAAQ,KAAKO,SAAAA,CAAzC,OAAA;AACA,UAAMC,eAAe,GAAGR,QAAQ,KAAKS,SAAAA,CAArC,GAAA;AAEA,aAAA,aACE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA,CAAA,GAAA,SAAA,CAAA,OAAA,EAAA,EAAA,EAAA,SAAA,EAAA;AAEE,QAAA,OAAO,EAAEX,IAAI,IAAJA,SAAAA,GAAAA,IAAAA,GAA2B,KAFtC,OAAA;AAGE,QAAA,SAAS,EAAE,CAAA,GAAA,WAAA,CAAA,OAAA,EAAW,CAAA,GAAA,aAAA,CAAA,OAAA,EAAA,MAAA,EAAX,QAAW,CAAX,EAA2C;AACpD,8BADoD,UAAA;AAEpD,6BAFoD,SAAA;AAGpD,4BAAkB,KAAA,KAAA,CAHkC,QAAA;AAIpD,6BAAmBF;AAJiC,SAA3C,EAAA,SAAA,MAAA,CAAA,IAAA,CAAA,EAHb,SAGa,CAHb;AASE,QAAA,GAAG,EAAE,KAAKZ;AATZ,OAAA,CAAA,EAAA,aAWE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,SAAA,CAAD,OAAA,EAAA,CAAA,GAAA,SAAA,CAAA,OAAA,EAAA,EAAA,EAAA,SAAA,EAAA;AAEE,QAAA,OAAO,EAAEc,IAAI,GAAG,KAAH,OAAA,GAFf,IAAA;AAGE,QAAA,SAAS,EAAE5B,UAAU,GAAA,OAAA,GAAa4B,IAAI,GAAA,GAAA,GAHxC,KAAA;AAIE,QAAA,SAAS,EAJX,UAAA;AAKE,QAAA,IAAI,EALN,IAAA;AAME,QAAA,QAAQ,EAAG,CAAA,UAAA,IAAe,CAAf,OAAA,IAA2B,CAA3B,IAAA,IAAA,SAAA,IANb,SAAA;AAOE,QAAA,KAAK,EAAE1B,SAAS,GAAG;AAAEsC,UAAAA,SAAS,EAAA,eAAA,MAAA,CAAiB,KAAA,KAAA,CAAjB,YAAA,EAAA,KAAA;AAAX,SAAH,GAAgE;AAPlF,OAAA,CAAA,EASGxC,UAAU,IAAA,aAAI,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,OAAA,EAAA,CAAA,GAAA,SAAA,CAAA,OAAA,EAAA,EAAA,EAAA,UAAA,EAAA;AAAuB,QAAA,IAAI,EAA3B,UAAA;AAAuC,QAAA,SAAS,EAAC;AAAjD,OAAA,CAAA,CATjB,EAAA,aAUE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EACGA,UAAU,IAAVA,eAAAA,IAAAA,aAAiC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAAA,aAAuC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,KAAA,CAAD,OAAA,EAD3E,IAC2E,CAAvC,CADpC,EAEGE,SAAS,IAATA,eAAAA,IAAAA,aAAgC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAd,qBAAA;AAAqC,QAAA,OAAO,EAAE,KAAKuC;AAAnD,OAAA,CAFnC,EAGGL,mBAAmB,IAAnBA,SAAAA,IAAAA,aACD,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,MAAA,CAAD,OAAA,EAAA;AACE,QAAA,OAAO,EAAE,KADX,WAAA;AAEE,QAAA,OAAO,EAAE,KAFX,UAAA;AAGE,QAAA,KAAK,EAAE,KAHT,SAAA;AAIE,QAAA,SAAS,EAAC;AAJZ,OAAA,EAAA,aAKC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,QAAA,CAAD,OAAA,EATH,IASG,CALD,CAJF,EAWGd,MAAM,IAAA,aAAI,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EArBf,MAqBe,CAXb,CAVF,EAAA,aAuBE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAAA,aACE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EADF,QACE,CADF,EAEGC,WAAW,IAAA,aAAI,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAFlB,WAEkB,CAFlB,EAGGpB,IAAI,KAAJA,GAAAA,IAAAA,aAAAA,IAAAA,aAAiC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EA1BtC,aA0BsC,CAHpC,CAvBF,EAAA,aA4BE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EA5BF,SA4BE,CA5BF,EAAA,aA6BE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAAA,YAAA,EAEGH,UAAU,IAAVA,mBAAAA,IAAAA,aAAqC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAAA,aAAuC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,KAAA,CAAD,OAAA,EAF/E,IAE+E,CAAvC,CAFxC,EAGGE,SAAS,IAATA,mBAAAA,IAAAA,aACD,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAd,qBAAA;AAAqC,QAAA,OAAO,EAAE,KAAKwC;AAAnD,OAAA,EAAA,aAAkE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,OAAA,CAAD,OAAA,EAJpE,IAIoE,CAAlE,CAJF,EAMGJ,eAAe,IAAfA,UAAAA,IAAiC,CAAjCA,SAAAA,IAAAA,aAA+C,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,QAAA,CAAD,OAAA,EAAA;AAAe,QAAA,SAAS,EAAC;AAAzB,OAAA,CANlD,EAOGA,eAAe,IAAfA,SAAAA,IAAAA,aACD,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,MAAA,CAAD,OAAA,EAAA;AACE,QAAA,SAAS,EADX,eAAA;AAEE,QAAA,OAAO,EAAE,KAFX,WAAA;AAGE,QAAA,OAAO,EAAE,KAHX,UAAA;AAIE,QAAA,KAAK,EAAE,KAAKK;AAJd,OAAA,EAAA,aAKC,MAAA,CAAA,OAAA,CAAA,aAAA,CAAC,YAAA,CAAD,OAAA,EArDP,IAqDO,CALD,CARF,CA7BF,CAXF,EAyDGzC,SAAS,IAATA,eAAAA,IAAAA,aACD,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AACE,QAAA,GAAG,EAAE,KADP,YAAA;AAEE,QAAA,SAAS,EAFX,cAAA;AAGE,QAAA,OAAO,EAAE,KAHX,aAAA;AAIE,QAAA,KAAK,EAAEA,SAAS,GAAG;AAAEsC,UAAAA,SAAS,EAAA,eAAA,MAAA,CAAiB,KAAA,KAAA,CAAjB,YAAA,EAAA,KAAA;AAAX,SAAH,GAAgE;AAJlF,OAAA,EAAA,aAME,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,MAAA,EAAA;AAAM,QAAA,SAAS,EAAC;AAAhB,OAAA,EAjEN,iBAiEM,CANF,CA1DF,CADF;AAsED;;;wBAvOc;AAAC,aAAO,KAAA,OAAA,CAAA,QAAA,IAAP,QAAA;AAA0C;AAE1D;;;;;;;;EAhCiBhD,MAAAA,CAAAA,S;;8BAAbD,I,kBAckB;AACpBK,EAAAA,SAAS,EADW,EAAA;AAEpBC,EAAAA,YAAY,EAFQ,EAAA;AAGpBC,EAAAA,UAAU,EAHU,KAAA;AAIpBC,EAAAA,QAAQ,EAJY,EAAA;AAKpBC,EAAAA,UAAU,EALU,KAAA;AAMpBC,EAAAA,SAAS,EANW,KAAA;AAOpBC,EAAAA,SAAS,EAPW,KAAA;AAQpBC,EAAAA,IAAI,EARgB,GAAA;AASpBC,EAAAA,iBAAiB,EAAE;AATC,C;8BAdlBb,I,kBA0BkB;AACpBc,EAAAA,QAAQ,EAAEC,UAAAA,CAAAA,OAAAA,CAAUC;AADA,C;;eA8OT,CAAA,GAAA,aAAA,CAAA,OAAA,EAAA,IAAA,C","sourcesContent":["import React, { Component, InputHTMLAttributes, ReactNode, MouseEvent } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from '../../lib/classNames';\nimport getClassName from '../../helpers/getClassName';\nimport Tappable from '../Tappable/Tappable';\nimport Touch, { TouchEvent } from '../Touch/Touch';\nimport { ANDROID, IOS } from '../../lib/platform';\nimport Icon24Chevron from '@vkontakte/icons/dist/24/chevron';\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\nimport Icon24Reorder from '@vkontakte/icons/dist/24/reorder';\nimport Icon24ReorderIos from '@vkontakte/icons/dist/24/reorder_ios';\nimport { HasChildren, HasPlatform, HasRootRef } from '../../types';\nimport withPlatform from '../../hoc/withPlatform';\n\ntype ProxyInputHTMLAttributes = Omit<InputHTMLAttributes<HTMLElement>, 'size'>;\n\nexport interface CellProps extends ProxyInputHTMLAttributes, HasChildren, HasRootRef<HTMLElement>, HasPlatform {\n  /**\n   * Контейнер для контента от `children`.\n   */\n  before?: ReactNode;\n  /**\n   * Контейнер для текста справа от `children`.\n   */\n  indicator?: ReactNode;\n  /**\n   * Контейнер для контента справа от `children` и `indicator`.\n   */\n  asideContent?: ReactNode;\n  /**\n   * Выставляйте этот флаг, если клик по ячейке вызывает переход на другую панель. Флаг нужен для корректной\n   * стилизации такой ячейки.\n   */\n  expandable?: boolean;\n  /**\n   * Добавляет возможность переноса содержимого `children` и `description`. Без этого флага текст будет уходить\n   * в троеточие.\n   */\n  multiline?: boolean;\n  /**\n   * Контейнер для дополнительного содержимого под `children`.\n   */\n  description?: ReactNode;\n  /**\n   * Контейнер для произвольного содержимого под `description`. Рисуется только если передать `size=\"l\"`.\n   */\n  bottomContent?: ReactNode;\n  /**\n   * Размер влияет на выравнивание блоков по вертикали, вид сепаратора (iOS) и возможность вставлять `bottomContent`.\n   */\n  size?: 'm' | 'l';\n  /**\n   * Флаг для перехода в режим ячеек-чекбоксов.\n   * **Важно:** в этом режиме обработчик `onClick` вызываться не будет.\n   * **Важно:** этот режим несовместим с `draggable`. В случае истинности двух этих флагов, приоритет отдается\n   * `draggable`.\n   */\n  selectable?: boolean;\n  /**\n   * Флаг для перехода в режим удаляемых ячеек. **Важно:** в этом режиме обработчик `onClick` вызываться не будет.\n   */\n  removable?: boolean;\n  /**\n   * Коллбэк срабатывает при клике на контрол удаления.\n   */\n  onRemove?(e: MouseEvent, rootEl: HTMLElement): void;\n  /**\n   * iOS only. Текст в выезжаеющей кнопке для удаления ячейки.\n   */\n  removePlaceholder?: ReactNode;\n  /**\n   * Флаг для перехода в режим перетаскивания. **Важно:** в этом режиме обработчик `onClick` вызываться не будет.\n   */\n  draggable?: boolean;\n  /**\n   * Коллбэк срабатывает при завершении перетаскивания.\n   * **Важно:** режим перетаскивания не меняет порядок ячеек в DOM. В коллбэке есть объект с полями `from` и `to`.\n   * Эти числа нужны для того, чтобы разработчик понимал, с какого индекса на какой произошел переход. В песочнице\n   * есть рабочий пример с обработкой этих чисел и перерисовкой списка.\n   */\n  onDragFinish?({ from, to }: { from: number; to: number }): void;\n  href?: string;\n  target?: string;\n}\n\nexport interface CellState {\n  isRemoveActivated: boolean;\n  removeOffset: number;\n  dragging: boolean;\n}\n\nclass Cell extends Component<CellProps, CellState> {\n  constructor(props: CellProps) {\n    super(props);\n\n    this.state = {\n      isRemoveActivated: false,\n      removeOffset: 0,\n      dragging: false,\n    };\n  }\n\n  rootEl: HTMLElement;\n  removeButton: HTMLDivElement;\n\n  static defaultProps = {\n    indicator: '',\n    asideContent: '',\n    expandable: false,\n    children: '',\n    selectable: false,\n    multiline: false,\n    removable: false,\n    size: 'm',\n    removePlaceholder: 'Удалить',\n  };\n\n  static contextTypes = {\n    document: PropTypes.any,\n  };\n\n  get document() {return this.context.document || document;}\n\n  /*\n   * предотвращает двойное срабатывание в случае с input\n   * (https://github.com/vuejs/vue/issues/3699#issuecomment-247957931)\n   * предотвращает клик в случае, когда включен режим removable\n   */\n  private readonly onClick = (e: MouseEvent<HTMLElement>): void => {\n    const { removable, onClick } = this.props;\n    const target = e.target as HTMLElement;\n    if (target.tagName.toLowerCase() === 'input') {\n      e.stopPropagation();\n    } else if (removable) {\n      return null;\n    } else {\n      onClick && onClick(e);\n    }\n  };\n\n  activateRemove = () => {\n    this.setState({ isRemoveActivated: true });\n    this.document.addEventListener('click', this.deactivateRemove);\n  };\n\n  deactivateRemove = () => {\n    this.setState({ isRemoveActivated: false, removeOffset: 0 });\n    this.document.removeEventListener('click', this.deactivateRemove);\n  };\n\n  private readonly onRemoveClick = (e: MouseEvent) => {\n    e.nativeEvent.stopImmediatePropagation();\n    e.preventDefault();\n    this.props.onRemove && this.props.onRemove(e, this.rootEl);\n  };\n\n  componentWillUnmount() {\n    this.document.removeEventListener('click', this.deactivateRemove);\n  }\n\n  componentDidUpdate(_prevProps: CellProps, prevState: CellState) {\n    if (prevState.isRemoveActivated !== this.state.isRemoveActivated && this.state.isRemoveActivated) {\n      this.setState({ removeOffset: this.removeButton.offsetWidth });\n    }\n  }\n\n  getRemoveRef = (el: HTMLDivElement) => this.removeButton = el;\n\n  getRootRef = (element: HTMLElement) => {\n    this.rootEl = element;\n\n    const getRootRef = this.props.getRootRef;\n    if (getRootRef) {\n      if (typeof getRootRef === 'function') {\n        getRootRef(element);\n      } else {\n        getRootRef.current = element;\n      }\n    }\n  };\n\n  dragShift: number;\n  listEl: HTMLElement;\n  siblings: HTMLElement[];\n  dragStartIndex: number;\n  dragEndIndex: number;\n  dragDirection: 'down' | 'up';\n\n  onDragStart = () => {\n    this.setState({ dragging: true });\n    this.dragShift = 0;\n    this.listEl = this.rootEl.closest('.List');\n    this.listEl && this.listEl.classList.add('List--dragging');\n    this.siblings = Array.prototype.slice.call(this.rootEl.parentElement.childNodes);\n    this.dragStartIndex = this.siblings.indexOf(this.rootEl);\n  };\n\n  onDragMove = (e: TouchEvent) => {\n    e.originalEvent.preventDefault();\n    if (this.state.removeOffset) {\n      return;\n    }\n\n    this.rootEl.style.transform = `translateY(${e.shiftY}px)`;\n    const rootGesture = this.rootEl.getBoundingClientRect();\n    this.dragDirection = this.dragShift - e.shiftY < 0 ? 'down' : 'up';\n    this.dragShift = e.shiftY;\n    this.dragEndIndex = this.dragStartIndex;\n\n    this.siblings.forEach((sibling, siblingIndex) => {\n      const siblingGesture = sibling.getBoundingClientRect();\n      if (this.dragStartIndex < siblingIndex) {\n        if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2) {\n          if (this.dragDirection === 'down') {\n            sibling.style.transform = 'translateY(-100%)';\n          }\n          this.dragEndIndex++;\n        }\n        if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2 && this.dragDirection === 'up') {\n          sibling.style.transform = 'translateY(0)';\n        }\n      } else if (this.dragStartIndex > siblingIndex) {\n        if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2) {\n          if (this.dragDirection === 'up') {\n            sibling.style.transform = 'translateY(100%)';\n          }\n          this.dragEndIndex--;\n        }\n        if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2 && this.dragDirection === 'down') {\n          sibling.style.transform = 'translateY(0)';\n        }\n      }\n    });\n  };\n\n  onDragEnd = () => {\n    this.setState({ dragging: false });\n    this.listEl && this.listEl.classList.remove('List--dragging');\n    this.props.onDragFinish && this.props.onDragFinish({ from: this.dragStartIndex, to: this.dragEndIndex });\n    this.siblings.forEach((sibling) => sibling.style.transform = null);\n    delete this.dragShift;\n    delete this.listEl;\n    delete this.siblings;\n    delete this.dragStartIndex;\n    delete this.dragEndIndex;\n    delete this.dragDirection;\n  };\n\n  render() {\n    let {\n      before,\n      indicator,\n      asideContent,\n      expandable,\n      onClick,\n      children,\n      getRootRef,\n      description,\n      selectable,\n      multiline,\n      className,\n      onRemove,\n      removable,\n      removePlaceholder,\n      draggable,\n      onDragFinish,\n      href,\n      size,\n      bottomContent,\n      platform,\n      onChange,\n      ...restProps\n    } = this.props;\n\n    selectable = selectable && !draggable;\n\n    const rootProps = selectable ? {} : restProps;\n    const inputProps = selectable ? { ...restProps, onChange } : {};\n    const linkProps = href ? restProps : {};\n    const IS_PLATFORM_ANDROID = platform === ANDROID;\n    const IS_PLATFORM_IOS = platform === IOS;\n\n    return (\n      <div\n        {...rootProps}\n        onClick={href || draggable ? null : this.onClick}\n        className={classNames(getClassName('Cell', platform), {\n          'Cell--expandable': expandable,\n          'Cell--multiline': multiline,\n          'Cell--dragging': this.state.dragging,\n          'Cell--draggable': draggable,\n        }, `Cell--${size}`, className)}\n        ref={this.getRootRef}\n      >\n        <Tappable\n          {...linkProps}\n          onClick={href ? this.onClick : null}\n          Component={selectable ? 'label' : href ? 'a' : 'div'}\n          className=\"Cell__in\"\n          href={href}\n          disabled={(!selectable && !onClick && !href || removable || draggable)}\n          style={removable ? { transform: `translateX(-${this.state.removeOffset}px)` } : null}\n        >\n          {selectable && <input {...inputProps} type=\"checkbox\" className=\"Cell__checkbox\" />}\n          <div className=\"Cell__before\">\n            {selectable && IS_PLATFORM_IOS && <div className=\"Cell__checkbox-marker\"><Icon16Done /></div>}\n            {removable && IS_PLATFORM_IOS && <div className=\"Cell__remove-marker\" onClick={this.activateRemove} />}\n            {IS_PLATFORM_ANDROID && draggable &&\n            <Touch\n              onStart={this.onDragStart}\n              onMoveY={this.onDragMove}\n              onEnd={this.onDragEnd}\n              className=\"Cell__dragger\"\n            ><Icon24Reorder /></Touch>\n            }\n            {before && <div className=\"Cell__before-in\">{before}</div>}\n          </div>\n          <div className=\"Cell__main\">\n            <div className=\"Cell__children\">{children}</div>\n            {description && <div className=\"Cell__description\">{description}</div>}\n            {size === 'l' && bottomContent && <div className=\"Cell__bottom\">{bottomContent}</div>}\n          </div>\n          <div className=\"Cell__indicator\">{indicator}</div>\n          <div className=\"Cell__aside\">\n            {asideContent}\n            {selectable && IS_PLATFORM_ANDROID && <div className=\"Cell__checkbox-marker\"><Icon16Done /></div>}\n            {removable && IS_PLATFORM_ANDROID &&\n            <div className=\"Cell__remove-marker\" onClick={this.onRemoveClick}><Icon24Cancel /></div>\n            }\n            {IS_PLATFORM_IOS && expandable && !draggable && <Icon24Chevron className=\"Cell__chevron\" />}\n            {IS_PLATFORM_IOS && draggable &&\n            <Touch\n              className=\"Cell__dragger\"\n              onStart={this.onDragStart}\n              onMoveY={this.onDragMove}\n              onEnd={this.onDragEnd}\n            ><Icon24ReorderIos /></Touch>\n            }\n          </div>\n        </Tappable>\n        {removable && IS_PLATFORM_IOS &&\n        <div\n          ref={this.getRemoveRef}\n          className=\"Cell__remove\"\n          onClick={this.onRemoveClick}\n          style={removable ? { transform: `translateX(-${this.state.removeOffset}px)` } : null}\n        >\n          <span className=\"Cell__remove-in\">{removePlaceholder}</span>\n        </div>\n        }\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(Cell);\n"]},"metadata":{},"sourceType":"script"}