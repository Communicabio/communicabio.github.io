{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _createSuper(Derived) {\n  return function () {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (_isNativeReflectConstruct()) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from '../../lib/classNames';\nimport getClassName from '../../helpers/getClassName';\nimport transitionEvents from '../../lib/transitionEvents';\nimport { ANDROID } from '../../lib/platform';\nimport withPlatform from '../../hoc/withPlatform';\n\nvar Root = /*#__PURE__*/function (_Component) {\n  _inherits(Root, _Component);\n\n  var _super = _createSuper(Root);\n\n  function Root(props) {\n    var _this;\n\n    _classCallCheck(this, Root);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"onAnimationEnd\", function (e) {\n      if (!e || ['root-android-animation-hide-back', 'root-android-animation-show-forward', 'root-ios-animation-hide-back', 'root-ios-animation-show-forward'].includes(e.animationName)) {\n        var isBack = _this.state.isBack;\n        var prevView = _this.state.prevView;\n        var nextView = _this.state.nextView;\n\n        _this.setState({\n          activeView: nextView,\n          prevView: null,\n          nextView: null,\n          visibleViews: [nextView],\n          transition: false,\n          isBack: undefined\n        }, function () {\n          _this.window.scrollTo(0, isBack ? _this.state.scrolls[_this.state.activeView] : 0);\n\n          _this.props.onTransition && _this.props.onTransition({\n            isBack: isBack,\n            from: prevView,\n            to: nextView\n          });\n        });\n      }\n    });\n\n    _this.state = {\n      activeView: props.activeView,\n      prevView: null,\n      nextView: null,\n      visibleViews: [props.activeView],\n      isBack: undefined,\n      scrolls: {},\n      transition: false\n    };\n    return _this;\n  }\n\n  _createClass(Root, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      if (this.props.popout && !prevProps.popout) {\n        this.blurActiveElement();\n      } // Нужен переход\n\n\n      if (this.props.activeView !== prevProps.activeView) {\n        var pageYOffset = this.window.pageYOffset;\n        var firstLayerId = [].concat(prevProps.children).find(function (view) {\n          return view.props.id === prevProps.activeView || view.props.id === _this2.props.activeView;\n        }).props.id;\n        var isBack = firstLayerId === this.props.activeView;\n        this.blurActiveElement();\n        var nextView = this.props.activeView;\n        var prevView = prevProps.activeView;\n        this.setState({\n          scrolls: _objectSpread({}, this.state.scrolls, _defineProperty({}, prevProps.activeView, pageYOffset)),\n          transition: true,\n          activeView: null,\n          nextView: nextView,\n          prevView: prevView,\n          visibleViews: [nextView, prevView],\n          isBack: isBack\n        });\n      } // Начался переход\n\n\n      if (!prevState.transition && this.state.transition) {\n        var prevViewElement = this.document.getElementById(\"view-\".concat(this.state.prevView));\n        var nextViewElement = this.document.getElementById(\"view-\".concat(this.state.nextView));\n        prevViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.prevView];\n\n        if (this.state.isBack) {\n          nextViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.nextView];\n        }\n\n        this.waitAnimationFinish(this.state.isBack ? prevViewElement : nextViewElement, this.onAnimationEnd);\n      }\n    }\n  }, {\n    key: \"shouldDisableTransitionMotion\",\n    value: function shouldDisableTransitionMotion() {\n      return this.context.transitionMotionEnabled === false;\n    }\n  }, {\n    key: \"waitAnimationFinish\",\n    value: function waitAnimationFinish(elem, eventHandler) {\n      if (this.shouldDisableTransitionMotion()) {\n        eventHandler();\n        return;\n      }\n\n      if (transitionEvents.supported) {\n        var eventName = transitionEvents.prefix ? transitionEvents.prefix + 'AnimationEnd' : 'animationend';\n        elem.removeEventListener(eventName, eventHandler);\n        elem.addEventListener(eventName, eventHandler);\n      } else {\n        setTimeout(eventHandler.bind(this), this.props.platform === ANDROID ? 300 : 600);\n      }\n    }\n  }, {\n    key: \"blurActiveElement\",\n    value: function blurActiveElement() {\n      if (typeof this.window !== 'undefined' && this.document.activeElement) {\n        this.document.activeElement.blur();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props = this.props,\n          popout = _this$props.popout,\n          modal = _this$props.modal,\n          platform = _this$props.platform;\n      var _this$state = this.state,\n          transition = _this$state.transition,\n          isBack = _this$state.isBack,\n          prevView = _this$state.prevView,\n          activeView = _this$state.activeView,\n          nextView = _this$state.nextView;\n      var Views = this.arrayChildren.filter(function (view) {\n        return _this3.state.visibleViews.includes(view.props.id);\n      });\n      var baseClassName = getClassName('Root', platform);\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: classNames(baseClassName, this.props.className, {\n          'Root--transition': transition,\n          'Root--no-motion': this.shouldDisableTransitionMotion()\n        })\n      }, Views.map(function (view) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          key: view.props.id,\n          id: \"view-\".concat(view.props.id),\n          className: classNames('Root__view', {\n            'Root__view--hide-back': view.props.id === prevView && isBack,\n            'Root__view--hide-forward': view.props.id === prevView && !isBack,\n            'Root__view--show-back': view.props.id === nextView && isBack,\n            'Root__view--show-forward': view.props.id === nextView && !isBack,\n            'Root__view--active': view.props.id === activeView\n          })\n        }, view);\n      }), !!popout && /*#__PURE__*/React.createElement(\"div\", {\n        className: \"Root__popout\"\n      }, popout), !!modal && /*#__PURE__*/React.createElement(\"div\", {\n        className: \"Root__modal\"\n      }, modal));\n    }\n  }, {\n    key: \"document\",\n    get: function get() {\n      return this.context.document || document;\n    }\n  }, {\n    key: \"window\",\n    get: function get() {\n      return this.context.window || window;\n    }\n  }, {\n    key: \"arrayChildren\",\n    get: function get() {\n      return [].concat(this.props.children);\n    }\n  }]);\n\n  return Root;\n}(Component);\n\n_defineProperty(Root, \"defaultProps\", {\n  popout: null\n});\n\n_defineProperty(Root, \"contextTypes\", {\n  window: PropTypes.any,\n  document: PropTypes.any,\n  transitionMotionEnabled: PropTypes.bool\n});\n\nexport default withPlatform(Root);","map":{"version":3,"sources":["../../../../src/components/Root/Root.tsx"],"names":["Root","Component","activeView","props","prevView","nextView","visibleViews","isBack","scrolls","transition","popout","window","PropTypes","document","transitionMotionEnabled","bool","prevProps","prevState","pageYOffset","firstLayerId","view","prevViewElement","nextViewElement","elem","eventHandler","transitionEvents","eventName","setTimeout","e","undefined","from","to","modal","platform","Views","baseClassName","getClassName","classNames","withPlatform"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, ReactElement, ReactNode } from 'react';\nimport PropTypes, { Requireable, Validator } from 'prop-types';\nimport classNames from '../../lib/classNames';\nimport getClassName from '../../helpers/getClassName';\nimport transitionEvents from '../../lib/transitionEvents';\nimport { ANDROID } from '../../lib/platform';\nimport withPlatform from '../../hoc/withPlatform';\nimport { HasPlatform } from '../../types';\n\nexport interface RootProps extends HTMLAttributes<HTMLDivElement>, HasPlatform {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  popout?: ReactNode;\n  modal?: ReactNode;\n}\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport interface RootState {\n  activeView: string;\n  prevView: string;\n  nextView: string;\n  visibleViews: [string] | [string, string];\n  isBack: boolean;\n  scrolls: {\n    [index: string]: number;\n  };\n  transition: boolean;\n}\n\nexport interface RootContext {\n  document: Requireable<object>;\n  window: Requireable<object>;\n  transitionMotionEnabled: Validator<boolean>;\n}\n\nclass Root extends Component<RootProps, RootState> {\n  constructor(props: RootProps) {\n    super(props);\n\n    this.state = {\n      activeView: props.activeView,\n      prevView: null,\n      nextView: null,\n      visibleViews: [props.activeView],\n      isBack: undefined,\n      scrolls: {},\n      transition: false,\n    };\n  }\n\n  static defaultProps: Partial<RootProps> = {\n    popout: null,\n  };\n\n  static contextTypes: RootContext = {\n    window: PropTypes.any,\n    document: PropTypes.any,\n    transitionMotionEnabled: PropTypes.bool,\n  };\n\n  get document() {\n    return this.context.document || document;\n  }\n\n  get window() {\n    return this.context.window || window;\n  }\n\n  get arrayChildren() {\n    return [].concat(this.props.children);\n  }\n\n  componentDidUpdate(prevProps: RootProps, prevState: RootState) {\n    if (this.props.popout && !prevProps.popout) {\n      this.blurActiveElement();\n    }\n\n    // Нужен переход\n    if (this.props.activeView !== prevProps.activeView) {\n      let pageYOffset = this.window.pageYOffset;\n      const firstLayerId = [].concat(prevProps.children).find((view: ReactElement) => {\n        return view.props.id === prevProps.activeView || view.props.id === this.props.activeView;\n      }).props.id;\n      const isBack = firstLayerId === this.props.activeView;\n\n      this.blurActiveElement();\n\n      const nextView = this.props.activeView;\n      const prevView = prevProps.activeView;\n\n      this.setState({\n        scrolls: {\n          ...this.state.scrolls,\n          [prevProps.activeView]: pageYOffset,\n        },\n        transition: true,\n        activeView: null,\n        nextView,\n        prevView,\n        visibleViews: [nextView, prevView],\n        isBack,\n      });\n    }\n\n    // Начался переход\n    if (!prevState.transition && this.state.transition) {\n      const prevViewElement = this.document.getElementById(`view-${this.state.prevView}`);\n      const nextViewElement = this.document.getElementById(`view-${this.state.nextView}`);\n\n      prevViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.prevView];\n\n      if (this.state.isBack) {\n        nextViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.nextView];\n      }\n      this.waitAnimationFinish(this.state.isBack ? prevViewElement : nextViewElement, this.onAnimationEnd);\n    }\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return this.context.transitionMotionEnabled === false;\n  }\n\n  waitAnimationFinish(elem: HTMLElement, eventHandler: AnimationEndCallback) {\n    if (this.shouldDisableTransitionMotion()) {\n      eventHandler();\n      return;\n    }\n\n    if (transitionEvents.supported) {\n      const eventName = transitionEvents.prefix ? transitionEvents.prefix + 'AnimationEnd' : 'animationend';\n\n      elem.removeEventListener(eventName, eventHandler);\n      elem.addEventListener(eventName, eventHandler);\n    } else {\n      setTimeout(eventHandler.bind(this), this.props.platform === ANDROID ? 300 : 600);\n    }\n  }\n\n  onAnimationEnd: AnimationEndCallback = (e?: AnimationEvent) => {\n    if (!e || [\n      'root-android-animation-hide-back',\n      'root-android-animation-show-forward',\n      'root-ios-animation-hide-back',\n      'root-ios-animation-show-forward',\n    ].includes(e.animationName)) {\n      const isBack = this.state.isBack;\n      const prevView = this.state.prevView;\n      const nextView = this.state.nextView;\n      this.setState({\n        activeView: nextView,\n        prevView: null,\n        nextView: null,\n        visibleViews: [nextView],\n        transition: false,\n        isBack: undefined,\n      }, () => {\n        this.window.scrollTo(0, isBack ? this.state.scrolls[this.state.activeView] : 0);\n        this.props.onTransition && this.props.onTransition({ isBack, from: prevView, to: nextView });\n      });\n    }\n  };\n\n  blurActiveElement() {\n    if (typeof this.window !== 'undefined' && this.document.activeElement) {\n      this.document.activeElement.blur();\n    }\n  }\n\n  render() {\n    const { popout, modal, platform } = this.props;\n    const { transition, isBack, prevView, activeView, nextView } = this.state;\n\n    const Views = this.arrayChildren.filter((view: ReactElement) => {\n      return this.state.visibleViews.includes(view.props.id);\n    });\n\n    const baseClassName = getClassName('Root', platform);\n\n    return (\n      <div className={classNames(baseClassName, this.props.className, {\n        'Root--transition': transition,\n        'Root--no-motion': this.shouldDisableTransitionMotion(),\n      })}>\n        {Views.map((view: ReactElement) => {\n          return (\n            <div key={view.props.id} id={`view-${view.props.id}`} className={classNames('Root__view', {\n              'Root__view--hide-back': view.props.id === prevView && isBack,\n              'Root__view--hide-forward': view.props.id === prevView && !isBack,\n              'Root__view--show-back': view.props.id === nextView && isBack,\n              'Root__view--show-forward': view.props.id === nextView && !isBack,\n              'Root__view--active': view.props.id === activeView,\n            })}>\n              {view}\n            </div>\n          );\n        })}\n        {!!popout && <div className=\"Root__popout\">{popout}</div>}\n        {!!modal && <div className=\"Root__modal\">{modal}</div>}\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(Root);\n"]},"metadata":{},"sourceType":"module"}