{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _touch = require(\"../../lib/touch\");\n\nvar _dom = require(\"../../lib/dom\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _createSuper(Derived) {\n  return function () {\n    var Super = (0, _getPrototypeOf2.default)(Derived),\n        result;\n\n    if (_isNativeReflectConstruct()) {\n      var NewTarget = (0, _getPrototypeOf2.default)(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2.default)(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar events = (0, _touch.getSupportedEvents)();\n\nvar Touch = /*#__PURE__*/function (_Component) {\n  (0, _inherits2.default)(Touch, _Component);\n\n  var _super = _createSuper(Touch);\n\n  function Touch(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, Touch);\n    _this = _super.call(this, props);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"cancelClick\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"gesture\", {});\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"container\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onStart\", function (e) {\n      _this.gesture = {\n        startX: (0, _touch.coordX)(e),\n        startY: (0, _touch.coordY)(e),\n        startT: new Date(),\n        isPressed: true\n      }; // Вызываем нужные колбеки из props\n\n      var outputEvent = _objectSpread({}, _this.gesture, {\n        originalEvent: e\n      });\n\n      if (_this.props.onStart) {\n        _this.props.onStart(outputEvent);\n      }\n\n      if (_this.props.onStartX) {\n        _this.props.onStartX(outputEvent);\n      }\n\n      if (_this.props.onStartY) {\n        _this.props.onStartY(outputEvent);\n      }\n\n      !_touch.touchEnabled && _this.subscribe(_this.document);\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onMove\", function (e) {\n      var _this$gesture = _this.gesture,\n          isPressed = _this$gesture.isPressed,\n          isX = _this$gesture.isX,\n          isY = _this$gesture.isY,\n          startX = _this$gesture.startX,\n          startY = _this$gesture.startY;\n\n      if (isPressed) {\n        // смещения\n        var shiftX = (0, _touch.coordX)(e) - startX;\n        var shiftY = (0, _touch.coordY)(e) - startY; // абсолютные значения смещений\n\n        var shiftXAbs = Math.abs(shiftX);\n        var shiftYAbs = Math.abs(shiftY); // Если определяем мультитач, то прерываем жест\n\n        if (!!e.touches && e.touches.length > 1) {\n          return _this.onEnd(e);\n        } // если мы ещё не определились\n\n\n        if (!isX && !isY) {\n          var willBeX = shiftXAbs >= 5 && shiftXAbs > shiftYAbs;\n          var willBeY = shiftYAbs >= 5 && shiftYAbs > shiftXAbs;\n          var willBeSlidedX = willBeX && !!_this.props.onMoveX || !!_this.props.onMove;\n          var willBeSlidedY = willBeY && !!_this.props.onMoveY || !!_this.props.onMove;\n          _this.gesture.isY = willBeY;\n          _this.gesture.isX = willBeX;\n          _this.gesture.isSlideX = willBeSlidedX;\n          _this.gesture.isSlideY = willBeSlidedY;\n          _this.gesture.isSlide = willBeSlidedX || willBeSlidedY;\n        }\n\n        if (_this.gesture.isSlide) {\n          _this.gesture.shiftX = shiftX;\n          _this.gesture.shiftY = shiftY;\n          _this.gesture.shiftXAbs = shiftXAbs;\n          _this.gesture.shiftYAbs = shiftYAbs; // Вызываем нужные колбеки из props\n\n          var _outputEvent = _objectSpread({}, _this.gesture, {\n            originalEvent: e\n          });\n\n          if (_this.props.onMove) {\n            _this.props.onMove(_outputEvent);\n          }\n\n          if (_this.gesture.isSlideX && _this.props.onMoveX) {\n            _this.props.onMoveX(_outputEvent);\n          }\n\n          if (_this.gesture.isSlideY && _this.props.onMoveY) {\n            _this.props.onMoveY(_outputEvent);\n          }\n        }\n      }\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onEnd\", function (e) {\n      var _this$gesture2 = _this.gesture,\n          isPressed = _this$gesture2.isPressed,\n          isSlide = _this$gesture2.isSlide,\n          isSlideX = _this$gesture2.isSlideX,\n          isSlideY = _this$gesture2.isSlideY;\n\n      if (isPressed) {\n        // Вызываем нужные колбеки из props\n        var _outputEvent2 = _objectSpread({}, _this.gesture, {\n          originalEvent: e\n        });\n\n        if (_this.props.onEnd) {\n          _this.props.onEnd(_outputEvent2);\n        }\n\n        if (isSlideY && _this.props.onEndY) {\n          _this.props.onEndY(_outputEvent2);\n        }\n\n        if (isSlideX && _this.props.onEndX) {\n          _this.props.onEndX(_outputEvent2);\n        }\n      }\n\n      var target = e.target; // Если закончили жест на ссылке, выставляем флаг для отмены перехода\n\n      _this.cancelClick = target.tagName === 'A' && isSlide;\n      _this.gesture = {};\n      !_touch.touchEnabled && _this.unsubscribe(_this.document);\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onDragStart\", function (e) {\n      var target = e.target;\n\n      if (target.tagName === 'A' || target.tagName === 'IMG') {\n        e.preventDefault();\n      }\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"onClick\", function (e) {\n      if (_this.cancelClick) {\n        _this.cancelClick = false;\n        e.preventDefault();\n      }\n\n      _this.props.onClick && _this.props.onClick(e);\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"getRef\", function (container) {\n      _this.container = container;\n      var getRootRef = _this.props.getRootRef;\n\n      if (getRootRef) {\n        if (typeof getRootRef === 'function') {\n          getRootRef(container);\n        } else {\n          getRootRef.current = container;\n        }\n      }\n    });\n    _this.cancelClick = false;\n    return _this;\n  }\n\n  (0, _createClass2.default)(Touch, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (_dom.canUseDOM) {\n        this.container.addEventListener(events[0], this.onStart, {\n          capture: this.props.useCapture,\n          passive: false\n        });\n        _touch.touchEnabled && this.subscribe(this.container);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.container.removeEventListener(events[0], this.onStart);\n      _touch.touchEnabled && this.unsubscribe(this.container);\n    }\n    /**\n     * Обработчик событий touchstart\n     *\n     * @param {Object} e Браузерное событие\n     * @return {void}\n     */\n\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(element) {\n      var listenerParams = {\n        capture: this.props.useCapture,\n        passive: false\n      };\n      element.addEventListener(events[1], this.onMove, listenerParams);\n      element.addEventListener(events[2], this.onEnd, listenerParams);\n      element.addEventListener(events[3], this.onEnd, listenerParams);\n    }\n  }, {\n    key: \"unsubscribe\",\n    value: function unsubscribe(element) {\n      // Здесь нужен последний аргумент с такими же параметрами, потому что\n      // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n      // https://github.com/VKCOM/VKUI/issues/444\n      var listenerParams = {\n        capture: this.props.useCapture,\n        passive: false\n      };\n      element.removeEventListener(events[1], this.onMove, listenerParams);\n      element.removeEventListener(events[2], this.onEnd, listenerParams);\n      element.removeEventListener(events[3], this.onEnd, listenerParams);\n    }\n    /**\n     * Обработчик событий dragstart\n     * Отменяет нативное браузерное поведение для вложенных ссылок и изображений\n     *\n     * @param {Object} e Браузерное событие\n     * @return {void}\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          onStart = _this$props.onStart,\n          onStartX = _this$props.onStartX,\n          onStartY = _this$props.onStartY,\n          onMove = _this$props.onMove,\n          onMoveX = _this$props.onMoveX,\n          onMoveY = _this$props.onMoveY,\n          onEnd = _this$props.onEnd,\n          onEndX = _this$props.onEndX,\n          onEndY = _this$props.onEndY,\n          useCapture = _this$props.useCapture,\n          Component = _this$props.Component,\n          getRootRef = _this$props.getRootRef,\n          restProps = (0, _objectWithoutProperties2.default)(_this$props, [\"onStart\", \"onStartX\", \"onStartY\", \"onMove\", \"onMoveX\", \"onMoveY\", \"onEnd\", \"onEndX\", \"onEndY\", \"useCapture\", \"Component\", \"getRootRef\"]);\n      return /*#__PURE__*/_react.default.createElement(Component, (0, _extends2.default)({}, restProps, {\n        onDragStart: this.onDragStart,\n        onClick: this.onClick,\n        ref: this.getRef\n      }), this.props.children);\n    }\n  }, {\n    key: \"document\",\n    get: function get() {\n      return this.context.document || document;\n    }\n  }]);\n  return Touch;\n}(_react.Component);\n\nexports.default = Touch;\n(0, _defineProperty2.default)(Touch, \"defaultProps\", {\n  Component: 'div',\n  children: '',\n  useCapture: false\n});\n(0, _defineProperty2.default)(Touch, \"contextTypes\", {\n  document: _propTypes.default.object\n});","map":{"version":3,"sources":["../../../src/components/Touch/Touch.tsx"],"names":["events","Touch","Component","children","useCapture","document","PropTypes","object","canUseDOM","capture","passive","touchEnabled","startX","startY","startT","isPressed","outputEvent","originalEvent","e","isX","isY","shiftX","shiftY","shiftXAbs","Math","shiftYAbs","willBeX","willBeY","willBeSlidedX","willBeSlidedY","isSlide","isSlideX","isSlideY","target","element","listenerParams","getRootRef","onStart","onStartX","onStartY","onMove","onMoveX","onMoveY","onEnd","onEndX","onEndY","restProps","getRef"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,MAAA,GAAA,uBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,CAAA;;AACA,IAAA,UAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,YAAA,CAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,iBAAA,CAAA;;AASA,IAAA,IAAA,GAAA,OAAA,CAAA,eAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA,IAAMA,MAAM,GAAG,CAAA,GAAA,MAAA,CAAf,kBAAe,GAAf;;IAEqBC,K;;;;;AACnB,WAAA,KAAA,CAAA,KAAA,EAA+B;AAAA,QAAA,KAAA;;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,IAAA,EAAA,KAAA;AAC7B,IAAA,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,EAAA,KAAA,CAAA;AAD6B,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,aAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,SAAA,EAAA,EAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,WAAA,EAAA,KAAA,CAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,SAAA,EAyCC,UAAA,CAAA,EAAuB;AACrD,MAAA,KAAA,CAAA,OAAA,GAAe;AACbW,QAAAA,MAAM,EAAE,CAAA,GAAA,MAAA,CAAA,MAAA,EADK,CACL,CADK;AAEbC,QAAAA,MAAM,EAAE,CAAA,GAAA,MAAA,CAAA,MAAA,EAFK,CAEL,CAFK;AAGbC,QAAAA,MAAM,EAAE,IAHK,IAGL,EAHK;AAIbC,QAAAA,SAAS,EAAE;AAJE,OAAf,CADqD,CAQrD;;AACA,UAAMC,WAAW,GAAA,aAAA,CAAA,EAAA,EACZ,KAAA,CADY,OAAA,EAAA;AAEfC,QAAAA,aAAa,EAAEC;AAFA,OAAA,CAAjB;;AAKA,UAAI,KAAA,CAAA,KAAA,CAAJ,OAAA,EAAwB;AACtB,QAAA,KAAA,CAAA,KAAA,CAAA,OAAA,CAAA,WAAA;AACD;;AAED,UAAI,KAAA,CAAA,KAAA,CAAJ,QAAA,EAAyB;AACvB,QAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,WAAA;AACD;;AAED,UAAI,KAAA,CAAA,KAAA,CAAJ,QAAA,EAAyB;AACvB,QAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,WAAA;AACD;;AAED,OAACP,MAAAA,CAAD,YAAA,IAAiB,KAAA,CAAA,SAAA,CAAe,KAAA,CAAhC,QAAiB,CAAjB;AAnE6B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,QAAA,EA4EA,UAAA,CAAA,EAAuB;AAAA,UAAA,aAAA,GACJ,KAAA,CADI,OAAA;AAAA,UAC5CI,SAD4C,GAAA,aAAA,CAAA,SAAA;AAAA,UACjCI,GADiC,GAAA,aAAA,CAAA,GAAA;AAAA,UAC5BC,GAD4B,GAAA,aAAA,CAAA,GAAA;AAAA,UACvBR,MADuB,GAAA,aAAA,CAAA,MAAA;AAAA,UACfC,MADe,GAAA,aAAA,CAAA,MAAA;;AAGpD,UAAA,SAAA,EAAe;AACb;AACA,YAAMQ,MAAM,GAAG,CAAA,GAAA,MAAA,CAAA,MAAA,EAAA,CAAA,IAAf,MAAA;AACA,YAAMC,MAAM,GAAG,CAAA,GAAA,MAAA,CAAA,MAAA,EAAA,CAAA,IAHF,MAGb,CAHa,CAKb;;AACA,YAAMC,SAAS,GAAGC,IAAI,CAAJA,GAAAA,CAAlB,MAAkBA,CAAlB;AACA,YAAMC,SAAS,GAAGD,IAAI,CAAJA,GAAAA,CAPL,MAOKA,CAAlB,CAPa,CASb;;AACA,YAAI,CAAC,CAACN,CAAC,CAAH,OAAA,IAAeA,CAAC,CAADA,OAAAA,CAAAA,MAAAA,GAAnB,CAAA,EAAyC;AACvC,iBAAO,KAAA,CAAA,KAAA,CAAP,CAAO,CAAP;AAXW,SAAA,CAcb;;;AACA,YAAI,CAAA,GAAA,IAAQ,CAAZ,GAAA,EAAkB;AAChB,cAAIQ,OAAO,GAAGH,SAAS,IAATA,CAAAA,IAAkBA,SAAS,GAAzC,SAAA;AACA,cAAII,OAAO,GAAGF,SAAS,IAATA,CAAAA,IAAkBA,SAAS,GAAzC,SAAA;AACA,cAAIG,aAAa,GAAGF,OAAO,IAAI,CAAC,CAAC,KAAA,CAAA,KAAA,CAAbA,OAAAA,IAAmC,CAAC,CAAC,KAAA,CAAA,KAAA,CAAzD,MAAA;AACA,cAAIG,aAAa,GAAGF,OAAO,IAAI,CAAC,CAAC,KAAA,CAAA,KAAA,CAAbA,OAAAA,IAAmC,CAAC,CAAC,KAAA,CAAA,KAAA,CAAzD,MAAA;AAEA,UAAA,KAAA,CAAA,OAAA,CAAA,GAAA,GAAA,OAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,GAAA,GAAA,OAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,QAAA,GAAA,aAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,QAAA,GAAA,aAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,OAAA,GAAuBC,aAAa,IAApC,aAAA;AACD;;AAED,YAAI,KAAA,CAAA,OAAA,CAAJ,OAAA,EAA0B;AACxB,UAAA,KAAA,CAAA,OAAA,CAAA,MAAA,GAAA,MAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,MAAA,GAAA,MAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,SAAA,GAAA,SAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,SAAA,GAJwB,SAIxB,CAJwB,CAMxB;;AACA,cAAMZ,YAAuB,GAAA,aAAA,CAAA,EAAA,EACxB,KAAA,CADwB,OAAA,EAAA;AAE3BC,YAAAA,aAAa,EAAEC;AAFY,WAAA,CAA7B;;AAKA,cAAI,KAAA,CAAA,KAAA,CAAJ,MAAA,EAAuB;AACrB,YAAA,KAAA,CAAA,KAAA,CAAA,MAAA,CAAA,YAAA;AACD;;AAED,cAAI,KAAA,CAAA,OAAA,CAAA,QAAA,IAAyB,KAAA,CAAA,KAAA,CAA7B,OAAA,EAAiD;AAC/C,YAAA,KAAA,CAAA,KAAA,CAAA,OAAA,CAAA,YAAA;AACD;;AAED,cAAI,KAAA,CAAA,OAAA,CAAA,QAAA,IAAyB,KAAA,CAAA,KAAA,CAA7B,OAAA,EAAiD;AAC/C,YAAA,KAAA,CAAA,KAAA,CAAA,OAAA,CAAA,YAAA;AACD;AACF;AACF;AAnI4B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,OAAA,EA4ID,UAAA,CAAA,EAAuB;AAAA,UAAA,cAAA,GACA,KAAA,CADA,OAAA;AAAA,UAC3CH,SAD2C,GAAA,cAAA,CAAA,SAAA;AAAA,UAChCe,OADgC,GAAA,cAAA,CAAA,OAAA;AAAA,UACvBC,QADuB,GAAA,cAAA,CAAA,QAAA;AAAA,UACbC,QADa,GAAA,cAAA,CAAA,QAAA;;AAGnD,UAAA,SAAA,EAAe;AACb;AACA,YAAMhB,aAAuB,GAAA,aAAA,CAAA,EAAA,EACxB,KAAA,CADwB,OAAA,EAAA;AAE3BC,UAAAA,aAAa,EAAEC;AAFY,SAAA,CAA7B;;AAKA,YAAI,KAAA,CAAA,KAAA,CAAJ,KAAA,EAAsB;AACpB,UAAA,KAAA,CAAA,KAAA,CAAA,KAAA,CAAA,aAAA;AACD;;AAED,YAAIc,QAAQ,IAAI,KAAA,CAAA,KAAA,CAAhB,MAAA,EAAmC;AACjC,UAAA,KAAA,CAAA,KAAA,CAAA,MAAA,CAAA,aAAA;AACD;;AAED,YAAID,QAAQ,IAAI,KAAA,CAAA,KAAA,CAAhB,MAAA,EAAmC;AACjC,UAAA,KAAA,CAAA,KAAA,CAAA,MAAA,CAAA,aAAA;AACD;AACF;;AAED,UAAME,MAAM,GAAGf,CAAC,CAvBmC,MAuBnD,CAvBmD,CAyBnD;;AACA,MAAA,KAAA,CAAA,WAAA,GAAmBe,MAAM,CAANA,OAAAA,KAAAA,GAAAA,IAAnB,OAAA;AACA,MAAA,KAAA,CAAA,OAAA,GAAA,EAAA;AAEA,OAACtB,MAAAA,CAAD,YAAA,IAAiB,KAAA,CAAA,WAAA,CAAiB,KAAA,CAAlC,QAAiB,CAAjB;AAzK6B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,aAAA,EAoMJ,UAAA,CAAA,EAA+B;AACxD,UAAMsB,MAAM,GAAGf,CAAC,CAAhB,MAAA;;AACA,UAAIe,MAAM,CAANA,OAAAA,KAAAA,GAAAA,IAA0BA,MAAM,CAANA,OAAAA,KAA9B,KAAA,EAAwD;AACtDf,QAAAA,CAAC,CAADA,cAAAA;AACD;AAxM4B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,SAAA,EAkNP,UAAA,CAAA,EAAgC;AACtD,UAAI,KAAA,CAAJ,WAAA,EAAsB;AACpB,QAAA,KAAA,CAAA,WAAA,GAAA,KAAA;AACAA,QAAAA,CAAC,CAADA,cAAAA;AACD;;AACD,MAAA,KAAA,CAAA,KAAA,CAAA,OAAA,IAAsB,KAAA,CAAA,KAAA,CAAA,OAAA,CAAtB,CAAsB,CAAtB;AAvN6B,KAAA;AAAA,KAAA,GAAA,gBAAA,CAAA,OAAA,EAAA,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,KAAA,CAAA,EAAA,QAAA,EA0ND,UAAA,SAAA,EAA4B;AACxD,MAAA,KAAA,CAAA,SAAA,GAAA,SAAA;AAEA,UAAMkB,UAAU,GAAG,KAAA,CAAA,KAAA,CAAnB,UAAA;;AACA,UAAA,UAAA,EAAgB;AACd,YAAI,OAAA,UAAA,KAAJ,UAAA,EAAsC;AACpCA,UAAAA,UAAU,CAAVA,SAAU,CAAVA;AADF,SAAA,MAEO;AACLA,UAAAA,UAAU,CAAVA,OAAAA,GAAAA,SAAAA;AACD;AACF;AApO4B,KAAA;AAE7B,IAAA,KAAA,CAAA,WAAA,GAAA,KAAA;AAF6B,WAAA,KAAA;AAG9B;;;;wCAoBmB;AAClB,UAAI5B,IAAAA,CAAJ,SAAA,EAAe;AACb,aAAA,SAAA,CAAA,gBAAA,CAAgCR,MAAM,CAAtC,CAAsC,CAAtC,EAA2C,KAA3C,OAAA,EAAyD;AAAES,UAAAA,OAAO,EAAE,KAAA,KAAA,CAAX,UAAA;AAAkCC,UAAAA,OAAO,EAAE;AAA3C,SAAzD;AACAC,QAAAA,MAAAA,CAAAA,YAAAA,IAAgB,KAAA,SAAA,CAAe,KAA/BA,SAAgB,CAAhBA;AACD;AACF;;;2CAEsB;AACrB,WAAA,SAAA,CAAA,mBAAA,CAAmCX,MAAM,CAAzC,CAAyC,CAAzC,EAA8C,KAA9C,OAAA;AACAW,MAAAA,MAAAA,CAAAA,YAAAA,IAAgB,KAAA,WAAA,CAAiB,KAAjCA,SAAgB,CAAhBA;AACD;AAED;;;;;;;;;8BAyIUuB,O,EAAsB;AAC9B,UAAMC,cAAc,GAAG;AAAE1B,QAAAA,OAAO,EAAE,KAAA,KAAA,CAAX,UAAA;AAAkCC,QAAAA,OAAO,EAAE;AAA3C,OAAvB;AACAwB,MAAAA,OAAO,CAAPA,gBAAAA,CAAyBlC,MAAM,CAA/BkC,CAA+B,CAA/BA,EAAoC,KAApCA,MAAAA,EAAAA,cAAAA;AACAA,MAAAA,OAAO,CAAPA,gBAAAA,CAAyBlC,MAAM,CAA/BkC,CAA+B,CAA/BA,EAAoC,KAApCA,KAAAA,EAAAA,cAAAA;AACAA,MAAAA,OAAO,CAAPA,gBAAAA,CAAyBlC,MAAM,CAA/BkC,CAA+B,CAA/BA,EAAoC,KAApCA,KAAAA,EAAAA,cAAAA;AACD;;;gCAEWA,O,EAAsB;AAChC;AACA;AACA;AACA,UAAMC,cAAc,GAAG;AAAE1B,QAAAA,OAAO,EAAE,KAAA,KAAA,CAAX,UAAA;AAAkCC,QAAAA,OAAO,EAAE;AAA3C,OAAvB;AACAwB,MAAAA,OAAO,CAAPA,mBAAAA,CAA4BlC,MAAM,CAAlCkC,CAAkC,CAAlCA,EAAuC,KAAvCA,MAAAA,EAAAA,cAAAA;AACAA,MAAAA,OAAO,CAAPA,mBAAAA,CAA4BlC,MAAM,CAAlCkC,CAAkC,CAAlCA,EAAuC,KAAvCA,KAAAA,EAAAA,cAAAA;AACAA,MAAAA,OAAO,CAAPA,mBAAAA,CAA4BlC,MAAM,CAAlCkC,CAAkC,CAAlCA,EAAuC,KAAvCA,KAAAA,EAAAA,cAAAA;AACD;AAED;;;;;;;;;;6BA0CS;AAAA,UAAA,WAAA,GAeH,KAfG,KAAA;AAAA,UAELG,OAFK,GAAA,WAAA,CAAA,OAAA;AAAA,UAGLC,QAHK,GAAA,WAAA,CAAA,QAAA;AAAA,UAILC,QAJK,GAAA,WAAA,CAAA,QAAA;AAAA,UAKLC,MALK,GAAA,WAAA,CAAA,MAAA;AAAA,UAMLC,OANK,GAAA,WAAA,CAAA,OAAA;AAAA,UAOLC,OAPK,GAAA,WAAA,CAAA,OAAA;AAAA,UAQLC,KARK,GAAA,WAAA,CAAA,KAAA;AAAA,UASLC,MATK,GAAA,WAAA,CAAA,MAAA;AAAA,UAULC,MAVK,GAAA,WAAA,CAAA,MAAA;AAAA,UAWLzC,UAXK,GAAA,WAAA,CAAA,UAAA;AAAA,UAYLF,SAZK,GAAA,WAAA,CAAA,SAAA;AAAA,UAaLkC,UAbK,GAAA,WAAA,CAAA,UAAA;AAAA,UAcFU,SAdE,GAAA,CAAA,GAAA,yBAAA,CAAA,OAAA,EAAA,WAAA,EAAA,CAAA,SAAA,EAAA,UAAA,EAAA,UAAA,EAAA,QAAA,EAAA,SAAA,EAAA,SAAA,EAAA,OAAA,EAAA,QAAA,EAAA,QAAA,EAAA,YAAA,EAAA,WAAA,EAAA,YAAA,CAAA,CAAA;AAiBP,aAAA,aACE,MAAA,CAAA,OAAA,CAAA,aAAA,CAAA,SAAA,EAAA,CAAA,GAAA,SAAA,CAAA,OAAA,EAAA,EAAA,EAAA,SAAA,EAAA;AAA0B,QAAA,WAAW,EAAE,KAAvC,WAAA;AAAyD,QAAA,OAAO,EAAE,KAAlE,OAAA;AAAgF,QAAA,GAAG,EAAE,KAAKC;AAA1F,OAAA,CAAA,EACG,KAAA,KAAA,CAFL,QACE,CADF;AAKD;;;wBA1Oc;AACb,aAAO,KAAA,OAAA,CAAA,QAAA,IAAP,QAAA;AACD;;;EAtBgC7C,MAAAA,CAAAA,S;;;8BAAdD,K,kBAUe;AAChCC,EAAAA,SAAS,EADuB,KAAA;AAEhCC,EAAAA,QAAQ,EAFwB,EAAA;AAGhCC,EAAAA,UAAU,EAAE;AAHoB,C;8BAVfH,K,kBAgBiB;AAClCI,EAAAA,QAAQ,EAAEC,UAAAA,CAAAA,OAAAA,CAAUC;AADc,C","sourcesContent":["import React, { Component, HTMLAttributes, DragEvent, ElementType, MouseEvent } from 'react';\nimport PropTypes, { Requireable } from 'prop-types';\nimport {\n  getSupportedEvents,\n  coordX,\n  coordY,\n  touchEnabled,\n  VKUITouchEvent,\n  VKUITouchEventHander,\n} from '../../lib/touch';\nimport { HasRootRef, OldRef } from '../../types';\nimport { canUseDOM } from '../../lib/dom';\n\nexport interface TouchProps extends HTMLAttributes<HTMLElement>, HasRootRef<HTMLElement> {\n  onStart?(outputEvent: TouchEvent): void;\n  onStartX?(outputEvent: TouchEvent): void;\n  onStartY?(outputEvent: TouchEvent): void;\n  onMove?(outputEvent: TouchEvent): void;\n  onMoveX?(outputEvent: TouchEvent): void;\n  onMoveY?(outputEvent: TouchEvent): void;\n  onEnd?(outputEvent: TouchEvent): void;\n  onEndX?(outputEvent: TouchEvent): void;\n  onEndY?(outputEvent: TouchEvent): void;\n  useCapture?: boolean;\n  Component?: ElementType;\n}\n\nexport interface TouchContext {\n  document: Requireable<{}>;\n}\n\nexport interface Gesture {\n  startX?: number;\n  startY?: number;\n  startT?: Date;\n  isPressed?: boolean;\n  isY?: boolean;\n  isX?: boolean;\n  isSlideX?: boolean;\n  isSlideY?: boolean;\n  isSlide?: boolean;\n  shiftX?: number;\n  shiftY?: number;\n  shiftXAbs?: number;\n  shiftYAbs?: number;\n}\n\nexport interface TouchEvent extends Gesture {\n  originalEvent: VKUITouchEvent;\n}\n\nexport type TouchEventHandler = (e: TouchEvent) => void;\nexport type ClickHandler = (e: MouseEvent<HTMLElement>) => void;\nexport type DragHandler = (e: DragEvent<HTMLElement>) => void;\n\nconst events = getSupportedEvents();\n\nexport default class Touch extends Component<TouchProps> {\n  constructor(props: TouchProps) {\n    super(props);\n    this.cancelClick = false;\n  }\n\n  cancelClick: boolean;\n  gesture: Partial<Gesture> = {};\n  container: HTMLElement;\n\n  static defaultProps: TouchProps = {\n    Component: 'div',\n    children: '',\n    useCapture: false,\n  };\n\n  static contextTypes: TouchContext = {\n    document: PropTypes.object,\n  };\n\n  get document() {\n    return this.context.document || document;\n  }\n\n  componentDidMount() {\n    if (canUseDOM) {\n      this.container.addEventListener(events[0], this.onStart, { capture: this.props.useCapture, passive: false });\n      touchEnabled && this.subscribe(this.container);\n    }\n  }\n\n  componentWillUnmount() {\n    this.container.removeEventListener(events[0], this.onStart);\n    touchEnabled && this.unsubscribe(this.container);\n  }\n\n  /**\n   * Обработчик событий touchstart\n   *\n   * @param {Object} e Браузерное событие\n   * @return {void}\n   */\n  onStart: VKUITouchEventHander = (e: VKUITouchEvent) => {\n    this.gesture = {\n      startX: coordX(e),\n      startY: coordY(e),\n      startT: new Date(),\n      isPressed: true,\n    };\n\n    // Вызываем нужные колбеки из props\n    const outputEvent = {\n      ...this.gesture,\n      originalEvent: e,\n    };\n\n    if (this.props.onStart) {\n      this.props.onStart(outputEvent);\n    }\n\n    if (this.props.onStartX) {\n      this.props.onStartX(outputEvent);\n    }\n\n    if (this.props.onStartY) {\n      this.props.onStartY(outputEvent);\n    }\n\n    !touchEnabled && this.subscribe(this.document);\n  };\n\n  /**\n   * Обработчик событий touchmove\n   *\n   * @param {Object} e Браузерное событие\n   * @return {void}\n   */\n  onMove: VKUITouchEventHander = (e: VKUITouchEvent) => {\n    const { isPressed, isX, isY, startX, startY } = this.gesture;\n\n    if (isPressed) {\n      // смещения\n      const shiftX = coordX(e) - startX;\n      const shiftY = coordY(e) - startY;\n\n      // абсолютные значения смещений\n      const shiftXAbs = Math.abs(shiftX);\n      const shiftYAbs = Math.abs(shiftY);\n\n      // Если определяем мультитач, то прерываем жест\n      if (!!e.touches && e.touches.length > 1) {\n        return this.onEnd(e);\n      }\n\n      // если мы ещё не определились\n      if (!isX && !isY) {\n        let willBeX = shiftXAbs >= 5 && shiftXAbs > shiftYAbs;\n        let willBeY = shiftYAbs >= 5 && shiftYAbs > shiftXAbs;\n        let willBeSlidedX = willBeX && !!this.props.onMoveX || !!this.props.onMove;\n        let willBeSlidedY = willBeY && !!this.props.onMoveY || !!this.props.onMove;\n\n        this.gesture.isY = willBeY;\n        this.gesture.isX = willBeX;\n        this.gesture.isSlideX = willBeSlidedX;\n        this.gesture.isSlideY = willBeSlidedY;\n        this.gesture.isSlide = willBeSlidedX || willBeSlidedY;\n      }\n\n      if (this.gesture.isSlide) {\n        this.gesture.shiftX = shiftX;\n        this.gesture.shiftY = shiftY;\n        this.gesture.shiftXAbs = shiftXAbs;\n        this.gesture.shiftYAbs = shiftYAbs;\n\n        // Вызываем нужные колбеки из props\n        const outputEvent: TouchEvent = {\n          ...this.gesture,\n          originalEvent: e,\n        };\n\n        if (this.props.onMove) {\n          this.props.onMove(outputEvent);\n        }\n\n        if (this.gesture.isSlideX && this.props.onMoveX) {\n          this.props.onMoveX(outputEvent);\n        }\n\n        if (this.gesture.isSlideY && this.props.onMoveY) {\n          this.props.onMoveY(outputEvent);\n        }\n      }\n    }\n  };\n\n  /**\n   * Обработчик событий touchend, touchcancel\n   *\n   * @param {Object} e Браузерное событие\n   * @return {void}\n   */\n  onEnd: VKUITouchEventHander = (e: VKUITouchEvent) => {\n    const { isPressed, isSlide, isSlideX, isSlideY } = this.gesture;\n\n    if (isPressed) {\n      // Вызываем нужные колбеки из props\n      const outputEvent: TouchEvent = {\n        ...this.gesture,\n        originalEvent: e,\n      };\n\n      if (this.props.onEnd) {\n        this.props.onEnd(outputEvent);\n      }\n\n      if (isSlideY && this.props.onEndY) {\n        this.props.onEndY(outputEvent);\n      }\n\n      if (isSlideX && this.props.onEndX) {\n        this.props.onEndX(outputEvent);\n      }\n    }\n\n    const target = e.target as HTMLElement;\n\n    // Если закончили жест на ссылке, выставляем флаг для отмены перехода\n    this.cancelClick = target.tagName === 'A' && isSlide;\n    this.gesture = {};\n\n    !touchEnabled && this.unsubscribe(this.document);\n  };\n\n  subscribe(element: HTMLElement) {\n    const listenerParams = { capture: this.props.useCapture, passive: false };\n    element.addEventListener(events[1], this.onMove, listenerParams);\n    element.addEventListener(events[2], this.onEnd, listenerParams);\n    element.addEventListener(events[3], this.onEnd, listenerParams);\n  }\n\n  unsubscribe(element: HTMLElement) {\n    // Здесь нужен последний аргумент с такими же параметрами, потому что\n    // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n    // https://github.com/VKCOM/VKUI/issues/444\n    const listenerParams = { capture: this.props.useCapture, passive: false };\n    element.removeEventListener(events[1], this.onMove, listenerParams);\n    element.removeEventListener(events[2], this.onEnd, listenerParams);\n    element.removeEventListener(events[3], this.onEnd, listenerParams);\n  }\n\n  /**\n   * Обработчик событий dragstart\n   * Отменяет нативное браузерное поведение для вложенных ссылок и изображений\n   *\n   * @param {Object} e Браузерное событие\n   * @return {void}\n   */\n  onDragStart: DragHandler = (e: DragEvent<HTMLElement>) => {\n    const target = e.target as HTMLElement;\n    if (target.tagName === 'A' || target.tagName === 'IMG') {\n      e.preventDefault();\n    }\n  };\n\n  /**\n   * Обработчик клика по компоненту\n   * Отменяет переход по вложенной ссылке, если был зафиксирован свайп\n   *\n   * @param {Object} e Браузерное событие\n   * @return {void}\n   */\n  onClick: ClickHandler = (e: MouseEvent<HTMLElement>) => {\n    if (this.cancelClick) {\n      this.cancelClick = false;\n      e.preventDefault();\n    }\n    this.props.onClick && this.props.onClick(e);\n  };\n\n  getRef: OldRef<HTMLElement> = (container: HTMLElement) => {\n    this.container = container;\n\n    const getRootRef = this.props.getRootRef;\n    if (getRootRef) {\n      if (typeof getRootRef === 'function') {\n        getRootRef(container);\n      } else {\n        getRootRef.current = container;\n      }\n    }\n  };\n\n  render() {\n    const {\n      onStart,\n      onStartX,\n      onStartY,\n      onMove,\n      onMoveX,\n      onMoveY,\n      onEnd,\n      onEndX,\n      onEndY,\n      useCapture,\n      Component,\n      getRootRef,\n      ...restProps\n    } = this.props;\n\n    return (\n      <Component {...restProps} onDragStart={this.onDragStart} onClick={this.onClick} ref={this.getRef}>\n        {this.props.children}\n      </Component>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"script"}