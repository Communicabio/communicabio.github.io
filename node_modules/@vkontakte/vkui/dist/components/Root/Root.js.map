{"version":3,"sources":["../../../src/components/Root/Root.tsx"],"names":["Root","props","e","includes","animationName","isBack","state","prevView","nextView","setState","activeView","visibleViews","transition","undefined","window","scrollTo","scrolls","onTransition","from","to","prevProps","prevState","popout","blurActiveElement","pageYOffset","firstLayerId","concat","children","find","view","id","prevViewElement","document","getElementById","nextViewElement","querySelector","scrollTop","waitAnimationFinish","onAnimationEnd","context","transitionMotionEnabled","elem","eventHandler","shouldDisableTransitionMotion","transitionEvents","supported","eventName","prefix","removeEventListener","addEventListener","setTimeout","bind","platform","ANDROID","activeElement","blur","modal","Views","arrayChildren","filter","baseClassName","className","map","Component","PropTypes","any","bool"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, ReactElement, ReactNode } from 'react';\nimport PropTypes, { Requireable, Validator } from 'prop-types';\nimport classNames from '../../lib/classNames';\nimport getClassName from '../../helpers/getClassName';\nimport transitionEvents from '../../lib/transitionEvents';\nimport { ANDROID } from '../../lib/platform';\nimport withPlatform from '../../hoc/withPlatform';\nimport { HasPlatform } from '../../types';\n\nexport interface RootProps extends HTMLAttributes<HTMLDivElement>, HasPlatform {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  popout?: ReactNode;\n  modal?: ReactNode;\n}\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport interface RootState {\n  activeView: string;\n  prevView: string;\n  nextView: string;\n  visibleViews: [string] | [string, string];\n  isBack: boolean;\n  scrolls: {\n    [index: string]: number;\n  };\n  transition: boolean;\n}\n\nexport interface RootContext {\n  document: Requireable<object>;\n  window: Requireable<object>;\n  transitionMotionEnabled: Validator<boolean>;\n}\n\nclass Root extends Component<RootProps, RootState> {\n  constructor(props: RootProps) {\n    super(props);\n\n    this.state = {\n      activeView: props.activeView,\n      prevView: null,\n      nextView: null,\n      visibleViews: [props.activeView],\n      isBack: undefined,\n      scrolls: {},\n      transition: false,\n    };\n  }\n\n  static defaultProps: Partial<RootProps> = {\n    popout: null,\n  };\n\n  static contextTypes: RootContext = {\n    window: PropTypes.any,\n    document: PropTypes.any,\n    transitionMotionEnabled: PropTypes.bool,\n  };\n\n  get document() {\n    return this.context.document || document;\n  }\n\n  get window() {\n    return this.context.window || window;\n  }\n\n  get arrayChildren() {\n    return [].concat(this.props.children);\n  }\n\n  componentDidUpdate(prevProps: RootProps, prevState: RootState) {\n    if (this.props.popout && !prevProps.popout) {\n      this.blurActiveElement();\n    }\n\n    // Нужен переход\n    if (this.props.activeView !== prevProps.activeView) {\n      let pageYOffset = this.window.pageYOffset;\n      const firstLayerId = [].concat(prevProps.children).find((view: ReactElement) => {\n        return view.props.id === prevProps.activeView || view.props.id === this.props.activeView;\n      }).props.id;\n      const isBack = firstLayerId === this.props.activeView;\n\n      this.blurActiveElement();\n\n      const nextView = this.props.activeView;\n      const prevView = prevProps.activeView;\n\n      this.setState({\n        scrolls: {\n          ...this.state.scrolls,\n          [prevProps.activeView]: pageYOffset,\n        },\n        transition: true,\n        activeView: null,\n        nextView,\n        prevView,\n        visibleViews: [nextView, prevView],\n        isBack,\n      });\n    }\n\n    // Начался переход\n    if (!prevState.transition && this.state.transition) {\n      const prevViewElement = this.document.getElementById(`view-${this.state.prevView}`);\n      const nextViewElement = this.document.getElementById(`view-${this.state.nextView}`);\n\n      prevViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.prevView];\n\n      if (this.state.isBack) {\n        nextViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.nextView];\n      }\n      this.waitAnimationFinish(this.state.isBack ? prevViewElement : nextViewElement, this.onAnimationEnd);\n    }\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return this.context.transitionMotionEnabled === false;\n  }\n\n  waitAnimationFinish(elem: HTMLElement, eventHandler: AnimationEndCallback) {\n    if (this.shouldDisableTransitionMotion()) {\n      eventHandler();\n      return;\n    }\n\n    if (transitionEvents.supported) {\n      const eventName = transitionEvents.prefix ? transitionEvents.prefix + 'AnimationEnd' : 'animationend';\n\n      elem.removeEventListener(eventName, eventHandler);\n      elem.addEventListener(eventName, eventHandler);\n    } else {\n      setTimeout(eventHandler.bind(this), this.props.platform === ANDROID ? 300 : 600);\n    }\n  }\n\n  onAnimationEnd: AnimationEndCallback = (e?: AnimationEvent) => {\n    if (!e || [\n      'root-android-animation-hide-back',\n      'root-android-animation-show-forward',\n      'root-ios-animation-hide-back',\n      'root-ios-animation-show-forward',\n    ].includes(e.animationName)) {\n      const isBack = this.state.isBack;\n      const prevView = this.state.prevView;\n      const nextView = this.state.nextView;\n      this.setState({\n        activeView: nextView,\n        prevView: null,\n        nextView: null,\n        visibleViews: [nextView],\n        transition: false,\n        isBack: undefined,\n      }, () => {\n        this.window.scrollTo(0, isBack ? this.state.scrolls[this.state.activeView] : 0);\n        this.props.onTransition && this.props.onTransition({ isBack, from: prevView, to: nextView });\n      });\n    }\n  };\n\n  blurActiveElement() {\n    if (typeof this.window !== 'undefined' && this.document.activeElement) {\n      this.document.activeElement.blur();\n    }\n  }\n\n  render() {\n    const { popout, modal, platform } = this.props;\n    const { transition, isBack, prevView, activeView, nextView } = this.state;\n\n    const Views = this.arrayChildren.filter((view: ReactElement) => {\n      return this.state.visibleViews.includes(view.props.id);\n    });\n\n    const baseClassName = getClassName('Root', platform);\n\n    return (\n      <div className={classNames(baseClassName, this.props.className, {\n        'Root--transition': transition,\n        'Root--no-motion': this.shouldDisableTransitionMotion(),\n      })}>\n        {Views.map((view: ReactElement) => {\n          return (\n            <div key={view.props.id} id={`view-${view.props.id}`} className={classNames('Root__view', {\n              'Root__view--hide-back': view.props.id === prevView && isBack,\n              'Root__view--hide-forward': view.props.id === prevView && !isBack,\n              'Root__view--show-back': view.props.id === nextView && isBack,\n              'Root__view--show-forward': view.props.id === nextView && !isBack,\n              'Root__view--active': view.props.id === activeView,\n            })}>\n              {view}\n            </div>\n          );\n        })}\n        {!!popout && <div className=\"Root__popout\">{popout}</div>}\n        {!!modal && <div className=\"Root__modal\">{modal}</div>}\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(Root);\n"],"file":"Root.js"}