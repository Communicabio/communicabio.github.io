{"version":3,"sources":["../../../src/components/Search/Search.tsx"],"names":["searchId","Search","props","e","setState","focused","onFocus","onBlur","target","isControlledOutside","value","onChange","nativeInputValueSetter","Object","getOwnPropertyDescriptor","window","HTMLInputElement","prototype","set","call","inputEl","ev2","Event","bubbles","dispatchEvent","onIconClick","originalEvent","preventDefault","focus","onCancel","element","getRef","current","state","hasOwnProperty","defaultValue","className","placeholder","after","platform","icon","inputProps","inputRef","IOS","__html","onIconClickStart","onIconCancelClickStart","Component","autoComplete"],"mappings":"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","sourcesContent":["import React, {\n  Component,\n  ReactNode,\n  FocusEvent,\n  FocusEventHandler,\n  InputHTMLAttributes,\n  ChangeEvent,\n  ChangeEventHandler,\n} from 'react';\nimport classNames from '../../lib/classNames';\nimport withPlatform from '../../hoc/withPlatform';\nimport getClassname from '../../helpers/getClassName';\nimport Icon16SearchOutline from '@vkontakte/icons/dist/16/search_outline';\nimport Icon16Clear from '@vkontakte/icons/dist/16/clear';\nimport { IOS } from '../../lib/platform';\nimport { HasPlatform, HasRef } from '../../types';\nimport Touch, { TouchEventHandler, TouchEvent } from '../Touch/Touch';\nimport { VKUITouchEvent } from '../../lib/touch';\n\nlet searchId = 0;\n\nexport type InputRef = (element: HTMLInputElement) => void;\n\nexport interface SearchProps extends InputHTMLAttributes<HTMLInputElement>, HasRef<HTMLInputElement>, HasPlatform {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: ReactNode;\n  icon?: ReactNode;\n  onIconClick?: (e: VKUITouchEvent) => void;\n  defaultValue?: string;\n}\n\nexport interface SearchState {\n  value?: string;\n  focused?: boolean;\n}\n\nclass Search extends Component<SearchProps, SearchState> {\n  static defaultProps: SearchProps = {\n    autoComplete: 'off',\n    placeholder: 'Поиск',\n    after: 'Отмена',\n  };\n\n  isControlledOutside: boolean;\n\n  inputEl: HTMLInputElement;\n\n  searchId: string;\n\n  constructor(props: SearchProps) {\n    super(props);\n\n    const state: SearchState = {\n      focused: false,\n    };\n\n    if (props.hasOwnProperty('value')) {\n      this.isControlledOutside = true;\n    } else {\n      state.value = props.defaultValue || '';\n    }\n    this.searchId = `search-${searchId++}`;\n    this.state = state;\n  }\n\n  get value() {\n    return this.isControlledOutside ? this.props.value : this.state.value;\n  }\n\n  onFocus: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: true });\n    this.props.onFocus && this.props.onFocus(e);\n  };\n\n  onBlur: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: false });\n    this.props.onBlur && this.props.onBlur(e);\n  };\n\n  onChange: ChangeEventHandler = (e?: ChangeEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    if (!this.isControlledOutside) {\n      this.setState({ value: target.value });\n    }\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n  };\n\n  onCancel: VoidFunction = () => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(this.inputEl, '');\n\n    const ev2 = new Event('input', { bubbles: true });\n    this.inputEl.dispatchEvent(ev2);\n  };\n\n  onIconClickStart: TouchEventHandler = (e: TouchEvent) => {\n    this.props.onIconClick && this.props.onIconClick(e.originalEvent);\n  };\n\n  onIconCancelClickStart: TouchEventHandler = (e: TouchEvent) => {\n    e.originalEvent.preventDefault();\n    this.inputEl.focus();\n    this.onCancel();\n  };\n\n  inputRef: InputRef = (element: HTMLInputElement) => {\n    const getRef = this.props.getRef;\n    this.inputEl = element;\n    if (getRef) {\n      if (typeof getRef === 'function') {\n        getRef(element);\n      } else {\n        getRef.current = element;\n      }\n    }\n  };\n\n  render() {\n    const {\n      className,\n      onFocus,\n      onBlur,\n      onChange,\n      defaultValue,\n      value,\n      placeholder,\n      after,\n      getRef,\n      platform,\n      icon,\n      onIconClick,\n      ...inputProps\n    } = this.props;\n\n    return (\n      <div className={classNames(getClassname('Search', platform), {\n        'Search--focused': this.state.focused,\n        'Search--has-value': !!this.value,\n        'Search--has-after': !!after,\n        'Search--has-icon': !!icon,\n      }, className)}>\n        <div className=\"Search__in\">\n          <div className=\"Search__width\" />\n          <div className=\"Search__control\">\n            <input\n              {...inputProps}\n              ref={this.inputRef}\n              type=\"text\"\n              className=\"Search__input\"\n              onFocus={this.onFocus}\n              onBlur={this.onBlur}\n              onChange={this.onChange}\n              value={this.value}\n            />\n            {platform === IOS && after && <div className=\"Search__after-width\">{after}</div>}\n            <div className=\"Search__placeholder\">\n              <div className=\"Search__placeholder-in\">\n                <Icon16SearchOutline />\n                <div className=\"Search__placeholder-text\" dangerouslySetInnerHTML={{ __html: placeholder }} />\n              </div>\n            </div>\n          </div>\n          <div className=\"Search__after\" onClick={this.onCancel}>\n            <div className=\"Search__icons\">\n              {icon &&\n                <Touch onStart={this.onIconClickStart} className=\"Search__icon\">\n                  {icon}\n                </Touch>\n              }\n              {!!this.value &&\n                <Touch onStart={this.onIconCancelClickStart} className=\"Search__icon\">\n                  <Icon16Clear />\n                </Touch>\n              }\n            </div>\n            {platform === IOS && after &&\n              <div className=\"Search__after-in\">{after}</div>\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(Search);\n"],"file":"Search.js"}