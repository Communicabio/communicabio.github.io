{"version":3,"sources":["../../../src/components/Snackbar/Snackbar.tsx"],"names":["Snackbar","props","canUseDOM","closeTimeout","window","setTimeout","close","duration","clearTimeout","e","action","onActionClick","el","innerEl","clearCloseTimeout","event","shiftX","startT","originalEvent","preventDefault","state","touched","setState","shiftXPercent","innerWidth","shiftXCurrent","platform","ANDROID","touchStartTime","setBodyTransform","newState","callback","shiftXReal","expectTranslateY","Date","now","getTime","waitTransitionFinish","bodyElRef","current","onClose","setCloseTimeout","closing","React","createRef","element","eventHandler","eventName","transitionEvents","transitionEndEventName","removeEventListener","addEventListener","percent","cancelAnimationFrame","animationFrame","requestAnimationFrame","style","transform","children","className","layout","before","after","resolvedLayout","getInnerRef","onTouchStart","onTouchMoveX","onTouchEnd","context","PureComponent","PropTypes","any","document"],"mappings":"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","sourcesContent":["import React, { HTMLAttributes, PureComponent, MouseEvent } from 'react';\nimport PropTypes from 'prop-types';\nimport withPlatform from '../../hoc/withPlatform';\nimport FixedLayout from '../FixedLayout/FixedLayout';\nimport Touch, { TouchEvent } from '../Touch/Touch';\nimport classNames from '../../lib/classNames';\nimport { HasPlatform } from '../../types';\nimport getClassname from '../../helpers/getClassName';\nimport { canUseDOM } from '../../lib/dom';\nimport transitionEvents from '../../lib/transitionEvents';\nimport { ANDROID } from '../../lib/platform';\nimport { rubber } from '../../lib/touch';\n\nexport interface SnackbarProps extends HTMLAttributes<HTMLElement>, HasPlatform {\n  /**\n   * Название кнопки действия в уведомлении\n   */\n  action?: string | React.ComponentType;\n\n  /**\n   * Будет вызвано при клике на кнопку действия\n   */\n  onActionClick?: (e: React.MouseEvent) => void;\n\n  /**\n   * Цветная иконка 24x24 пикселя\n   */\n  before?: React.ReactNode;\n  /**\n   * Контент в правой части, может быть `<Avatar size={32} />`\n   */\n  after?: React.ReactNode;\n  /**\n   * Варианты расположения кнопки\n   */\n  layout?: 'vertical' | 'horizontal';\n  /**\n   * Время в миллисекундах, через которое плашка скроется\n   */\n  duration?: number;\n  /**\n   * Обработчик закрытия уведомления\n   */\n  onClose: () => void;\n}\n\nexport interface SnackbarState {\n  closing: boolean;\n  touched: boolean;\n}\n\nclass Snackbar extends PureComponent<SnackbarProps, SnackbarState> {\n  constructor(props: SnackbarProps) {\n    super(props);\n\n    this.state = {\n      closing: false,\n      touched: false,\n    };\n\n    this.bodyElRef = React.createRef();\n\n    this.shiftXPercent = 0;\n    this.shiftXCurrent = 0;\n  }\n\n  static defaultProps = {\n    duration: 4000,\n  };\n\n  static contextTypes = {\n    window: PropTypes.any,\n    document: PropTypes.any,\n  };\n\n  private innerEl: HTMLDivElement;\n  private readonly bodyElRef: React.RefObject<HTMLDivElement>;\n  private closeTimeout: number;\n\n  private shiftXPercent: number;\n  private shiftXCurrent: number;\n  private touchStartTime: Date;\n  private animationFrame: number;\n\n  componentDidMount() {\n    this.setCloseTimeout();\n  }\n\n  componentWillUnmount() {\n    this.clearCloseTimeout();\n  }\n\n  get window() {\n    return this.context.window || window;\n  }\n\n  setCloseTimeout = () => {\n    if (canUseDOM) {\n      this.closeTimeout = window.setTimeout(() => {\n        this.close();\n      }, this.props.duration);\n    }\n  };\n\n  clearCloseTimeout = () => {\n    clearTimeout(this.closeTimeout);\n  };\n\n  private readonly onActionClick = (e: MouseEvent) => {\n    this.close();\n\n    if (this.props.action && typeof this.props.onActionClick === 'function') {\n      this.props.onActionClick(e);\n    }\n  };\n\n  close() {\n    this.setState({ closing: true });\n    this.waitTransitionFinish(this.innerEl, () => {\n      this.props.onClose();\n    });\n  }\n\n  waitTransitionFinish(element: HTMLElement, eventHandler: VoidFunction) {\n    if (element) {\n      const eventName = transitionEvents.transitionEndEventName;\n\n      element.removeEventListener(eventName, eventHandler);\n      element.addEventListener(eventName, eventHandler);\n    }\n  }\n\n  getInnerRef = (el: HTMLDivElement) => this.innerEl = el;\n\n  onTouchStart = () => {\n    this.clearCloseTimeout();\n  };\n\n  onTouchMoveX = (event: TouchEvent) => {\n    const { shiftX, startT, originalEvent } = event;\n    originalEvent.preventDefault();\n\n    if (!this.state.touched) {\n      this.setState({ touched: true });\n    }\n\n    this.shiftXPercent = shiftX / this.window.innerWidth * 100;\n    this.shiftXCurrent = rubber(this.shiftXPercent, 72, 1.2, this.props.platform === ANDROID);\n    this.touchStartTime = startT;\n\n    this.setBodyTransform(this.shiftXCurrent);\n  };\n\n  onTouchEnd = () => {\n    const newState = {\n      touched: false,\n    };\n\n    let callback;\n\n    if (this.state.touched) {\n      let shiftXReal = this.shiftXCurrent;\n      const expectTranslateY = shiftXReal / (Date.now() - this.touchStartTime.getTime()) * 240 * 0.6 * (this.shiftXPercent < 0 ? -1 : 1);\n      shiftXReal = shiftXReal + expectTranslateY;\n\n      if (shiftXReal >= 50) {\n        this.clearCloseTimeout();\n        this.waitTransitionFinish(this.bodyElRef.current, () => {\n          this.props.onClose();\n        });\n        this.setBodyTransform(120);\n      } else {\n        callback = () => {\n          this.setCloseTimeout();\n          this.setBodyTransform(0);\n        };\n      }\n    } else {\n      this.setCloseTimeout();\n    }\n\n    this.setState(newState, callback);\n  };\n\n  setBodyTransform(percent: number) {\n    cancelAnimationFrame(this.animationFrame);\n    this.animationFrame = requestAnimationFrame(() => {\n      this.bodyElRef.current.style.transform = `translate3d(${percent}%, 0, 0)`;\n    });\n  }\n\n  render() {\n    const {\n      children,\n      className,\n      platform,\n      layout,\n      action,\n      before,\n      after,\n    } = this.props;\n\n    const resolvedLayout = after ? 'vertical' : layout;\n\n    return (\n      <FixedLayout\n        vertical=\"bottom\"\n        className={classNames(getClassname('Snackbar', platform), className, `Snackbar--l-${resolvedLayout}`, {\n          'Snackbar--closing': this.state.closing,\n          'Snackbar--touched': this.state.touched,\n        })}\n      >\n        <Touch\n          className=\"Snackbar__in\"\n          getRootRef={this.getInnerRef}\n          onStart={this.onTouchStart}\n          onMoveX={this.onTouchMoveX}\n          onEnd={this.onTouchEnd}\n        >\n          <div className=\"Snackbar__body\" ref={this.bodyElRef}>\n            {before &&\n            <div className=\"Snackbar__before\">\n              {before}\n            </div>}\n\n            <div className=\"Snackbar__content\">\n              <div className=\"Snackbar__content-text\">{children}</div>\n\n              {action &&\n              <button className=\"Snackbar__action\" onClick={this.onActionClick}>\n                <div className=\"Snackbar__action-self\">{action}</div>\n              </button>}\n            </div>\n\n            {after &&\n            <div className=\"Snackbar__after\">\n              {after}\n            </div>}\n          </div>\n        </Touch>\n      </FixedLayout>\n    );\n  }\n}\n\nexport default withPlatform(Snackbar);\n"],"file":"Snackbar.js"}