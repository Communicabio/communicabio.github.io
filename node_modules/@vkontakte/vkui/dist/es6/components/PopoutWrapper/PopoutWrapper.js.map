{"version":3,"sources":["../../../../src/components/PopoutWrapper/PopoutWrapper.tsx"],"names":["React","Component","getClassName","classNames","ANDROID","transitionEvents","withPlatform","canUseDOM","PopoutWrapper","props","e","animationName","setState","opened","preventDefault","state","onClick","elRef","createRef","window","addEventListener","preventTouch","passive","waitAnimationFinish","current","onFadeInEnd","removeEventListener","clearTimeout","animationFinishTimeout","elem","eventHandler","supported","eventName","prefix","platform","setTimeout","alignY","alignX","closing","children","hasMask","className","restProps","baseClassNames"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, MouseEvent } from 'react';\nimport getClassName from '../../helpers/getClassName';\nimport classNames from '../../lib/classNames';\nimport { ANDROID } from '../../lib/platform';\nimport transitionEvents from '../../lib/transitionEvents';\nimport withPlatform from '../../hoc/withPlatform';\nimport { HasPlatform } from '../../types';\nimport { canUseDOM } from '../../lib/dom';\n\nexport interface PopoutWrapperProps extends HTMLAttributes<HTMLDivElement>, HasPlatform {\n  hasMask?: boolean;\n  alignY?: 'top' | 'center' | 'bottom';\n  alignX?: 'left' | 'center' | 'right';\n  closing?: boolean;\n}\n\nexport interface PopoutWrapperState {\n  opened: boolean;\n}\n\nexport type WindowTouchListener = (e: Event) => void;\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport type ClickHandler = (e: MouseEvent<HTMLDivElement>) => void;\n\nclass PopoutWrapper extends Component<PopoutWrapperProps, PopoutWrapperState> {\n  constructor(props: PopoutWrapperProps) {\n    super(props);\n    this.state = {\n      opened: false,\n    };\n    this.elRef = React.createRef();\n  }\n\n  static defaultProps: PopoutWrapperProps = {\n    hasMask: true,\n    alignY: 'center',\n    alignX: 'center',\n    closing: false,\n  };\n\n  elRef: React.RefObject<HTMLDivElement>;\n\n  animationFinishTimeout: number;\n\n  componentDidMount() {\n    if (canUseDOM) {\n      window.addEventListener('touchmove', this.preventTouch, { passive: false });\n      this.waitAnimationFinish(this.elRef.current, this.onFadeInEnd);\n    }\n  }\n\n  componentWillUnmount() {\n    // Здесь нужен последний аргумент с такими же параметрами, потому что\n    // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n    // https://github.com/VKCOM/VKUI/issues/444\n    if (canUseDOM) {\n      // @ts-ignore (В интерфейсе EventListenerOptions нет поля passive)\n      window.removeEventListener('touchmove', this.preventTouch, { passive: false });\n      window.clearTimeout(this.animationFinishTimeout);\n    }\n  }\n\n  waitAnimationFinish(elem: HTMLDivElement, eventHandler: AnimationEndCallback) {\n    if (transitionEvents.supported) {\n      const eventName = transitionEvents.prefix ? transitionEvents.prefix + 'AnimationEnd' : 'animationend';\n      elem.removeEventListener(eventName, eventHandler);\n      elem.addEventListener(eventName, eventHandler);\n    } else {\n      const { platform } = this.props;\n      this.animationFinishTimeout = window.setTimeout(eventHandler, platform === ANDROID ? 300 : 600);\n    }\n  }\n\n  onFadeInEnd: AnimationEndCallback = (e: AnimationEvent) => {\n    if (!e || e.animationName === 'animation-full-fade-in') {\n      this.setState({ opened: true });\n    }\n  };\n\n  preventTouch: WindowTouchListener = (e: Event) => e.preventDefault();\n\n  onClick: ClickHandler = (e: MouseEvent<HTMLDivElement>) => {\n    if (this.state.opened && this.props.onClick) {\n      this.props.onClick(e);\n    }\n  };\n\n  render() {\n    const { alignY, alignX, closing, children, hasMask, onClick, className, platform, ...restProps } = this.props;\n    const baseClassNames = getClassName('PopoutWrapper', platform);\n\n    return (\n      <div\n        {...restProps}\n        className={classNames(baseClassNames, `PopoutWrapper--v-${alignY}`, `PopoutWrapper--h-${alignX}`, {\n          'PopoutWrapper--closing': closing,\n        }, className)}\n        onClick={this.onClick}\n        ref={this.elRef}\n      >\n        {hasMask && <div className=\"PopoutWrapper__mask\" />}\n        <div className=\"PopoutWrapper__container\">{children}</div>\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(PopoutWrapper);\n"],"file":"PopoutWrapper.js"}